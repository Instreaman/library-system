# å›¾ä¹¦å€Ÿé˜…ç³»ç»Ÿå®è®­æ“ä½œæ‰‹å†Œ

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0
**æŠ€æœ¯æ¶æ„**ï¼šSpring Boot + MyBatis-Plus + MariaDB + HTML/Axios
**è®¤è¯æ–¹å¼**ï¼šåŸç”Ÿæ‹¦æˆªå™¨ + Hutool JWTï¼Œä¸é‡‡ç”¨ Spring Securityï¼Œä¸“æ³¨ç™»å½•é‰´æƒ

æ“ä½œæ‰‹å†Œæä¾›äº†æˆç†Ÿçš„ä»£ç ï¼Œä¸€è·¯è·Ÿç€æ•²æˆ–è€…å¤åˆ¶ç²˜è´´éƒ½å¯ä»¥å®Œæˆæœ€åçš„å†…å®¹ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å¯¹ç€å„ä¸ªä»£ç çš„çŸ¥è¯†ç‚¹è¿›è¡Œå¤§æ¨¡å‹çš„æœç´¢ï¼Œé¡¹ç›®å¹¶ä¸æ˜¯æœ€ä½³è§„èŒƒï¼Œå¿…è¦çš„å†…å®¹æˆ‘åšäº†ä¸€äº›ç²¾ç®€çš„å†™æ³•ï¼Œä»¥è¾ƒç®€å•çš„æ–¹å¼å®ç°äº†è¿™ä»½å®æ“çš„å†…å®¹



## 0.æˆå“é¢„è§ˆ

![PixPin_2025-12-29_10-46-58](https://prorise-blog.oss-cn-guangzhou.aliyuncs.com/cover/PixPin_2025-12-29_10-46-58.webp)

![image-20251229104529971](https://prorise-blog.oss-cn-guangzhou.aliyuncs.com/cover/image-20251229104529971.png)

![image-20251229104543336](https://prorise-blog.oss-cn-guangzhou.aliyuncs.com/cover/image-20251229104543336.png)

![image-20251229104554168](https://prorise-blog.oss-cn-guangzhou.aliyuncs.com/cover/image-20251229104554168.png)

![image-20251229104617711](https://prorise-blog.oss-cn-guangzhou.aliyuncs.com/cover/image-20251229104617711.png)



![image-20251229104628514](https://prorise-blog.oss-cn-guangzhou.aliyuncs.com/cover/image-20251229104628514.png)

## 1. æ•°æ®åº“ç¯å¢ƒæ„å»º

åœ¨è¿›è¡Œä»£ç ç¼–å†™å‰ï¼Œå¿…é¡»å®Œæˆæ•°æ®åº“çš„åˆå§‹åŒ–ã€‚è¯·åœ¨ MariaDB/MySQL æ•°æ®åº“ç®¡ç†å·¥å…·ï¼ˆå¦‚ Navicatã€SQLyogï¼‰ï¼Œæˆ–ä½¿ç”¨ç»ˆç«¯å‘½ä»¤è¡Œæ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚

### **æ­¥éª¤ 1.1**ï¼šåˆ›å»ºæ•°æ®åº“

æ‰§è¡Œ SQL è¯­å¥åˆ›å»ºåä¸º `library_db` çš„æ•°æ®åº“ï¼ˆMariaDB ç¯å¢ƒï¼‰ã€‚

**ç»ˆç«¯æ“ä½œç¤ºä¾‹ï¼ˆArch Linuxï¼‰**ï¼š
```bash
# å¯åŠ¨ MariaDB CLIï¼ˆå·²è®¾ç½®æœ¬åœ°è´¦å·ï¼‰
mariadb -u library -p

# è‹¥ä½¿ç”¨ root è´¦å·
# mariadb -u root -p

# ç™»å½•åæ‰§è¡Œå»ºåº“å»ºè¡¨è„šæœ¬
```

**ä¸€æ¬¡æ€§å¯¼å…¥è„šæœ¬ï¼ˆç»ˆç«¯ï¼‰**ï¼š
```bash
# åœ¨ä»“åº“æ ¹ç›®å½•ä¸‹ï¼Œç›´æ¥å¯¼å…¥åˆå§‹åŒ–è„šæœ¬
mariadb -u library -p library_db < database/init.sql
# å¦‚éœ€å…ˆåˆ›å»ºåº“å†å¯¼å…¥ï¼Œå¯å…ˆæ‰§è¡Œå»ºåº“ SQLï¼Œæˆ–ä½¿ç”¨ root è´¦å·ï¼š
# mariadb -u root -p < database/init.sql
```

```sql
CREATE DATABASE library_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE library_db;
```

![image-20251229084815627](https://prorise-blog.oss-cn-guangzhou.aliyuncs.com/cover/image-20251229084815627.png)

### **æ­¥éª¤ 1.2**ï¼šæ‰§è¡Œå»ºè¡¨è„šæœ¬
å¤åˆ¶ä»¥ä¸‹SQLè¯­å¥å¹¶åœ¨æ•°æ®åº“ä¸­è¿è¡Œï¼Œä»¥ç”Ÿæˆé¡¹ç›®æ‰€éœ€çš„è¡¨ç»“æ„å’Œåˆå§‹åŒ–æ•°æ®ã€‚

```sql
-- 1. å›¾ä¹¦è¡¨
CREATE TABLE book (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    title VARCHAR(100) NOT NULL COMMENT 'ä¹¦å',
    author VARCHAR(50) COMMENT 'ä½œè€…',
    publisher VARCHAR(50) COMMENT 'å‡ºç‰ˆç¤¾',
    total_quantity INT DEFAULT 0 COMMENT 'æ€»åº“å­˜',
    borrowed_quantity INT DEFAULT 0 COMMENT 'å·²å€Ÿå‡ºæ•°é‡',
    available_quantity INT DEFAULT 0 COMMENT 'å‰©ä½™åº“å­˜'
);

-- 2. ç”¨æˆ·è¡¨
CREATE TABLE user (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    username VARCHAR(30) UNIQUE NOT NULL COMMENT 'ç”¨æˆ·å',
    real_name VARCHAR(30) COMMENT 'çœŸå®å§“å',
    password VARCHAR(100) NOT NULL COMMENT 'å¯†ç ',
    role VARCHAR(20) NOT NULL COMMENT 'è§’è‰² ADMIN/USER'
);

-- 3. å€Ÿé˜…è®°å½•è¡¨
CREATE TABLE borrow_record (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    book_id INT NOT NULL COMMENT 'å›¾ä¹¦ID',
    user_id INT NOT NULL COMMENT 'ç”¨æˆ·ID',
    borrow_time DATETIME COMMENT 'å€Ÿé˜…æ—¶é—´',
    return_time DATETIME COMMENT 'å½’è¿˜æ—¶é—´',
    status VARCHAR(20) NOT NULL COMMENT 'çŠ¶æ€ BORROWED/RETURNED',
    FOREIGN KEY (book_id) REFERENCES book(id),
    FOREIGN KEY (user_id) REFERENCES user(id)
);

-- 4. åˆå§‹åŒ–æµ‹è¯•æ•°æ®
INSERT INTO user (username, real_name, password, role) VALUES 
('admin', 'ç®¡ç†å‘˜', 'admin123', 'ADMIN'),
('user1', 'å¼ ä¸‰', 'user123', 'USER');

INSERT INTO book (title, author, publisher, total_quantity, borrowed_quantity, available_quantity) VALUES 
('Javaç¼–ç¨‹æ€æƒ³', 'Bruce Eckel', 'æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾', 10, 0, 10),
('æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ', 'Randal E. Bryant', 'æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾', 5, 0, 5);

```

### æ­¥éª¤1.3ï¼šæ•°æ®åº“è¡¨å…³ç³»æ¦‚è§ˆ

| **ä¸»è¡¨ (ä»è¡¨)**                | **å¤–é”®å­—æ®µ** | **å…³è”ä¸»è¡¨**      | **å…³è”ä¸»é”®** | **å…³ç³»ç±»å‹**     | **ä¸šåŠ¡å«ä¹‰**                                                 |
| ------------------------------ | ------------ | ----------------- | ------------ | ---------------- | ------------------------------------------------------------ |
| **borrow_record** (å€Ÿé˜…è®°å½•è¡¨) | `book_id`    | **book** (å›¾ä¹¦è¡¨) | `id`         | **å¤šå¯¹ä¸€ (N:1)** | ä¸€æœ¬å›¾ä¹¦å¯ä»¥æœ‰åŒ…å«å¤šæ¡å€Ÿé˜…å†å²ï¼Œä½†æ¯ä¸€æ¡å€Ÿé˜…è®°å½•åªå¯¹åº”ä¸€æœ¬å…·ä½“çš„ä¹¦ã€‚ |
| **borrow_record** (å€Ÿé˜…è®°å½•è¡¨) | `user_id`    | **user** (ç”¨æˆ·è¡¨) | `id`         | **å¤šå¯¹ä¸€ (N:1)** | ä¸€ä¸ªç”¨æˆ·å¯ä»¥äº§ç”Ÿå¤šæ¡å€Ÿé˜…è®°å½•ï¼Œä½†æ¯ä¸€æ¡å€Ÿé˜…è®°å½•åªå±äºä¸€ä¸ªå…·ä½“çš„ç”¨æˆ·ã€‚ |

**æ ¸å¿ƒé€»è¾‘è¯´æ˜ï¼š**

- **User** å’Œ **Book** ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„å¤–é”®å…³è”ã€‚
- **Borrow_record** æ˜¯ä¸­é—´è¡¨ï¼ˆå…³è”è¡¨ï¼‰ï¼Œé€šè¿‡å­˜å‚¨ `book_id` å’Œ `user_id` æ¥å»ºç«‹â€œè°å€Ÿäº†ä»€ä¹ˆä¹¦â€çš„è”ç³»ã€‚

---

## 2. åç«¯é¡¹ç›®åˆå§‹åŒ–

### **æ­¥éª¤ 2.1**ï¼šåˆ›å»º Spring Boot é¡¹ç›®
ä½¿ç”¨ Spring Initializrï¼ˆVS Code æ‰©å±•æˆ– start.spring.ioï¼‰æ–°å»ºé¡¹ç›®ï¼ŒGroup è®¾ç½®ä¸º `com.example`ï¼ŒArtifact è®¾ç½®ä¸º `library`ã€‚

![image-20251229085234928](https://prorise-blog.oss-cn-guangzhou.aliyuncs.com/cover/image-20251229085234928.png)

**æ³¨æ„ï¼šä¸è¦é€‰æ‹©4.0.0ï¼**

![image-20251229085302072](https://prorise-blog.oss-cn-guangzhou.aliyuncs.com/cover/image-20251229085302072.png)



### **æ­¥éª¤ 2.2**ï¼šé…ç½®ä¾èµ–æ–‡ä»¶
æ‰“å¼€æ ¹ç›®å½•ä¸‹çš„ `pom.xml` æ–‡ä»¶ï¼Œç¡®è®¤å¹¶æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ã€‚

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
         https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.4.1</version>
        <relativePath/>
    </parent>

    <groupId>com.example</groupId>
    <artifactId>library</artifactId>
    <version>1.0.0</version>
    <name>library</name>
    <description>Library Management System</description>

    <properties>
        <java.version>17</java.version>
        <maven.compiler.source>17</maven.compiler.source>
        <maven.compiler.target>17</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <hutool.version>5.8.25</hutool.version>
        <mybatis-plus.version>3.5.7</mybatis-plus.version>
    </properties>

    <repositories>
        <repository>
            <id>aliyun</id>
            <name>Aliyun Maven Repository</name>
            <url>https://maven.aliyun.com/repository/public</url>
            <releases>
                <enabled>true</enabled>
            </releases>
            <snapshots>
                <enabled>true</enabled>
            </snapshots>
        </repository>
        <repository>
            <id>central</id>
            <name>Maven Central</name>
            <url>https://repo.maven.apache.org/maven2</url>
        </repository>
    </repositories>

    <pluginRepositories>
        <pluginRepository>
            <id>aliyun-plugin</id>
            <name>Aliyun Maven Plugin Repository</name>
            <url>https://maven.aliyun.com/repository/public</url>
            <releases>
                <enabled>true</enabled>
            </releases>
            <snapshots>
                <enabled>true</enabled>
            </snapshots>
        </pluginRepository>
    </pluginRepositories>

    <dependencies>
        <!-- Web ä¾èµ–ï¼šæä¾› RESTful API æ”¯æŒ -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- MariaDB é©±åŠ¨ï¼šè¿æ¥æ•°æ®åº“ -->
        <dependency>
            <groupId>org.mariadb.jdbc</groupId>
            <artifactId>mariadb-java-client</artifactId>
            <version>3.3.3</version>
        </dependency>

        <!-- MyBatis-Plusï¼šç®€åŒ–æ•°æ®åº“æ“ä½œï¼Œæ— éœ€ç¼–å†™ XML -->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-spring-boot3-starter</artifactId>
            <version>${mybatis-plus.version}</version>
        </dependency>

        <!-- Lombokï¼šè‡ªåŠ¨ç”Ÿæˆ getter/setterï¼Œå‡å°‘æ ·æ¿ä»£ç  -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>

        <!-- Hutoolï¼šæä¾› JWTã€Bean æ‹·è´ã€æ—¥æœŸå¤„ç†ç­‰å·¥å…·ï¼ˆå®é™…ä½¿ç”¨ Hutool JWTï¼‰ -->
        <dependency>
            <groupId>cn.hutool</groupId>
            <artifactId>hutool-all</artifactId>
            <version>${hutool.version}</version>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>
```

![image-20251229090219548](C:%5CUsers%5CProrise%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20251229090219548.png)

### **æ­¥éª¤ 2.3**ï¼šé…ç½®åº”ç”¨ç¨‹åºå‚æ•°
ç¼–è¾‘ `src/main/resources/application.yml`ï¼ˆå¦‚æœæ˜¯ `.properties` æ–‡ä»¶è¯·æ”¹ä¸º `.yml`ï¼‰ï¼š

```yaml
# æœåŠ¡å™¨é…ç½®
server:
    port: 8080  # åº”ç”¨å¯åŠ¨ç«¯å£

# æ•°æ®æºé…ç½®ï¼ˆMariaDBï¼‰
spring:
    application:
        name: library
    datasource:
        driver-class-name: org.mariadb.jdbc.Driver
        url: jdbc:mariadb://localhost:3306/library_db?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
        username: library
        password: library123  # âš ï¸ è¯·æ›¿æ¢ä¸ºä½ çš„å®é™… MariaDB å¯†ç 
    jackson:
        date-format: yyyy-MM-dd HH:mm:ss
        time-zone: GMT+8

# MyBatis-Plus é…ç½®
mybatis-plus:
    configuration:
        map-underscore-to-camel-case: true
        log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    global-config:
        db-config:
            id-type: auto
    mapper-locations: classpath*:/mapper/**/*.xml
```

**é…ç½®é¡¹è§£é‡Š**ï¼š
- `log-impl`ï¼šå¼€å¯åæ¯æ¬¡æ‰§è¡Œ SQL éƒ½ä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºï¼Œå¸®åŠ©ä½ ç†è§£ MyBatis-Plus è‡ªåŠ¨ç”Ÿæˆçš„ SQL
- `map-underscore-to-camel-case`ï¼šæ•°æ®åº“è¡¨å­—æ®µé€šå¸¸ç”¨ä¸‹åˆ’çº¿å‘½åï¼ˆå¦‚ `real_name`ï¼‰ï¼ŒJava ç±»ç”¨é©¼å³°å‘½åï¼ˆå¦‚ `realName`ï¼‰ï¼Œå¼€å¯åè‡ªåŠ¨æ˜ å°„

---

## 3. åç«¯é€šç”¨æ¨¡å—å¼€å‘

### **æ­¥éª¤ 3.1**ï¼šåˆ›å»ºç»Ÿä¸€å“åº”ç±»
åœ¨ `src/main/java/com/example/library/common` åŒ…ä¸‹åˆ›å»º `Result.java`ï¼š

```java
package com.example.library.common;

import lombok.Data;

/**
 * ç»Ÿä¸€å“åº”ç»“æœå°è£…ç±»
 * æ‰€æœ‰æ¥å£è¿”å›çš„æ•°æ®éƒ½ç”¨è¿™ä¸ªç±»åŒ…è£…ï¼Œå‰ç«¯å¯ä»¥ç»Ÿä¸€å¤„ç†
 */
@Data
public class Result<T> {
    private Integer code;    // çŠ¶æ€ç ï¼š200 æˆåŠŸï¼Œ400 å¤±è´¥
    private String message;  // æç¤ºä¿¡æ¯
    private T data;          // è¿”å›çš„æ•°æ®ï¼ˆæ³›å‹ï¼Œå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼‰

    /**
     * æˆåŠŸå“åº”ï¼ˆå¸¦æ•°æ®ï¼‰
     */
    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.setCode(200);
        result.setMessage("æ“ä½œæˆåŠŸ");
        result.setData(data);
        return result;
    }

    /**
     * æˆåŠŸå“åº”ï¼ˆè‡ªå®šä¹‰æ¶ˆæ¯ï¼‰
     */
    public static <T> Result<T> success(String message) {
        Result<T> result = new Result<>();
        result.setCode(200);
        result.setMessage(message);
        return result;
    }

    /**
     * å¤±è´¥å“åº”
     */
    public static <T> Result<T> error(String message) {
        Result<T> result = new Result<>();
        result.setCode(400);
        result.setMessage(message);
        return result;
    }
}
```

**ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªç±»ï¼Ÿ**
- å‰ç«¯å‘é€è¯·æ±‚åï¼Œéœ€è¦çŸ¥é“æ“ä½œæ˜¯å¦æˆåŠŸã€å¤±è´¥åŸå› æ˜¯ä»€ä¹ˆã€è¿”å›äº†ä»€ä¹ˆæ•°æ®
- ç»Ÿä¸€æ ¼å¼åï¼Œå‰ç«¯åªéœ€åˆ¤æ–­ `code` æ˜¯å¦ä¸º 200ï¼Œè€Œä¸ç”¨æ¯ä¸ªæ¥å£å•ç‹¬å¤„ç†

### **æ­¥éª¤ 3.2**ï¼šåˆ›å»º JWT å·¥å…·ç±»
åœ¨ `src/main/java/com/example/library/utils` åŒ…ä¸‹åˆ›å»º `JwtUtils.java`ï¼š

```java
package com.example.library.utils;

import cn.hutool.core.date.DateUtil;
import cn.hutool.jwt.JWT;
import cn.hutool.jwt.JWTUtil;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

/**
 * JWT å·¥å…·ç±»ï¼ˆåŸºäº Hutoolï¼‰
 * ç”¨äºç”Ÿæˆå’Œè§£æç”¨æˆ·ç™»å½•å‡­è¯ï¼ˆTokenï¼‰
 */
public class JwtUtils {

    // å¯†é’¥ï¼šç”¨äºç­¾åå’ŒéªŒè¯ Tokenï¼ˆç”Ÿäº§ç¯å¢ƒåº”æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼‰
    private static final String SECRET_KEY = "LibraryProjectSecretKey2025";

    // Token æœ‰æ•ˆæœŸï¼š24 å°æ—¶ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰
    private static final long EXPIRATION = 1000 * 60 * 60 * 24;

    /**
     * ç”Ÿæˆ Token
     * @param userId ç”¨æˆ·ID
     * @param username ç”¨æˆ·å
     * @param role è§’è‰²ï¼ˆADMIN æˆ– USERï¼‰
     * @return ç”Ÿæˆçš„ Token å­—ç¬¦ä¸²
     */
    public static String generateToken(Integer userId, String username, String role) {
        // æ„å»ºè½½è·æ•°æ®ï¼ˆPayloadï¼‰
        Map<String, Object> payload = new HashMap<>();
        payload.put("userId", userId);
        payload.put("username", username);
        payload.put("role", role);
        payload.put("exp", DateUtil.offsetMillisecond(new Date(), (int) EXPIRATION)); // è¿‡æœŸæ—¶é—´

        // ä½¿ç”¨ Hutool çš„ JWTUtil ç”Ÿæˆ Token
        return JWTUtil.createToken(payload, SECRET_KEY.getBytes());
    }

    /**
     * è§£æ Token
     * @param token å‰ç«¯ä¼ æ¥çš„ Token
     * @return JWT å¯¹è±¡ï¼ˆåŒ…å«è½½è·æ•°æ®ï¼‰ï¼Œå¦‚æœéªŒè¯å¤±è´¥è¿”å› null
     */
    public static JWT parseToken(String token) {
        try {
            // éªŒè¯ Token æ˜¯å¦æœ‰æ•ˆï¼ˆç­¾åæ˜¯å¦æ­£ç¡®ã€æ˜¯å¦è¿‡æœŸï¼‰
            boolean verify = JWTUtil.verify(token, SECRET_KEY.getBytes());
            if (verify) {
                return JWTUtil.parseToken(token); // è¿”å›è§£æåçš„ JWT å¯¹è±¡
            }
        } catch (Exception e) {
            // Token æ ¼å¼é”™è¯¯æˆ–å·²è¿‡æœŸ
            return null;
        }
        return null;
    }

    /**
     * ä» Token ä¸­æå–ç”¨æˆ· ID
     */
    public static Integer getUserId(String token) {
        JWT jwt = parseToken(token);
        return jwt != null ? (Integer) jwt.getPayload("userId") : null;
    }

    /**
     * ä» Token ä¸­æå–è§’è‰²
     */
    public static String getRole(String token) {
        JWT jwt = parseToken(token);
        return jwt != null ? (String) jwt.getPayload("role") : null;
    }
}
```

**å…³é”®çŸ¥è¯†ç‚¹**ï¼š
- **JWT çš„ç»„æˆ**ï¼šç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼ˆHeader.Payload.Signatureï¼‰ï¼Œç”¨ `.` åˆ†éš”
- **Payloadï¼ˆè½½è·ï¼‰**ï¼šå­˜æ”¾ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚ userIdã€roleï¼‰ï¼Œä½†ä¸è¦å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰
- **Signatureï¼ˆç­¾åï¼‰**ï¼šç”¨å¯†é’¥å¯¹å‰ä¸¤éƒ¨åˆ†åŠ å¯†ï¼Œé˜²æ­¢ Token è¢«ç¯¡æ”¹
- **Hutool çš„ä¼˜åŠ¿**ï¼šAPI ç®€æ´ã€ä¾èµ–è½»é‡ï¼Œç»“åˆæ‹¦æˆªå™¨å³å¯å®Œæˆç™»å½•é‰´æƒ

---

## 4. æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰ä¸å®ä½“å±‚å¼€å‘

### **æ­¥éª¤ 4.1**ï¼šåˆ›å»ºç™»å½•è¯·æ±‚ DTO
åœ¨ `src/main/java/com/example/library/dto` åŒ…ä¸‹åˆ›å»º `LoginDTO.java`ï¼š

```java
package com.example.library.dto;

import lombok.Data;

/**
 * ç™»å½•è¯·æ±‚æ•°æ®ä¼ è¾“å¯¹è±¡
 * å‰ç«¯æäº¤ç™»å½•è¡¨å•æ—¶ï¼Œæ•°æ®ä¼šè‡ªåŠ¨å°è£…åˆ°è¿™ä¸ªå¯¹è±¡ä¸­
 */
@Data
public class LoginDTO {
    private String username;  // ç”¨æˆ·å
    private String password;  // å¯†ç 
}
```

**ä¸ºä»€ä¹ˆéœ€è¦ DTOï¼Ÿ**
- å‰ç«¯ä¼ æ¥çš„æ•°æ®å¯èƒ½åªåŒ…å«éƒ¨åˆ†å­—æ®µï¼ˆå¦‚ç™»å½•åªéœ€è¦ç”¨æˆ·åå’Œå¯†ç ï¼‰
- ç›´æ¥ç”¨å®ä½“ç±»ï¼ˆEntityï¼‰æ¥æ”¶ä¼šå¯¼è‡´å…¶ä»–å­—æ®µä¸º nullï¼Œä¸”ä¸å®‰å…¨
- DTO å¯ä»¥ç²¾ç¡®æ§åˆ¶æ¥æ”¶å“ªäº›å­—æ®µ

### **æ­¥éª¤ 4.2**ï¼šåˆ›å»ºå®ä½“ç±»
åœ¨ `src/main/java/com/example/library/entity` åŒ…ä¸‹åˆ›å»ºä¸‰ä¸ªå®ä½“ç±»ï¼š

**User.java**ï¼ˆç”¨æˆ·è¡¨å®ä½“ï¼‰

```java
package com.example.library.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

/**
 * ç”¨æˆ·å®ä½“ç±»
 * å¯¹åº”æ•°æ®åº“è¡¨ï¼šuser
 */
@Data
@TableName("user")  // æŒ‡å®šå¯¹åº”çš„æ•°æ®åº“è¡¨å
public class User {
    @TableId(type = IdType.AUTO)  // ä¸»é”®è‡ªå¢
    private Integer id;

    private String username;   // ç”¨æˆ·åï¼ˆç™»å½•è´¦å·ï¼‰
    private String realName;   // çœŸå®å§“å
    private String password;   // å¯†ç ï¼ˆå®é™…é¡¹ç›®åº”åŠ å¯†å­˜å‚¨ï¼‰
    private String role;       // è§’è‰²ï¼šADMINï¼ˆç®¡ç†å‘˜ï¼‰æˆ– USERï¼ˆæ™®é€šç”¨æˆ·ï¼‰
}
```

**Book.java**ï¼ˆå›¾ä¹¦è¡¨å®ä½“ï¼‰

```java
package com.example.library.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

/**
 * å›¾ä¹¦å®ä½“ç±»
 * å¯¹åº”æ•°æ®åº“è¡¨ï¼šbook
 */
@Data
@TableName("book")
public class Book {
    @TableId(type = IdType.AUTO)
    private Integer id;

    private String title;              // ä¹¦å
    private String author;             // ä½œè€…
    private String publisher;          // å‡ºç‰ˆç¤¾
    private Integer totalQuantity;     // æ€»åº“å­˜
    private Integer borrowedQuantity;  // å·²å€Ÿå‡ºæ•°é‡
    private Integer availableQuantity; // å‰©ä½™åº“å­˜
}
```

**BorrowRecord.java**ï¼ˆå€Ÿé˜…è®°å½•è¡¨å®ä½“ï¼‰

```java
package com.example.library.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;
import java.time.LocalDateTime;

/**
 * å€Ÿé˜…è®°å½•å®ä½“ç±»
 * å¯¹åº”æ•°æ®åº“è¡¨ï¼šborrow_record
 */
@Data
@TableName("borrow_record")
public class BorrowRecord {
    @TableId(type = IdType.AUTO)
    private Integer id;

    private Integer bookId;              // å›¾ä¹¦IDï¼ˆå¤–é”®ï¼‰
    private Integer userId;              // ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
    private LocalDateTime borrowTime;    // å€Ÿé˜…æ—¶é—´
    private LocalDateTime returnTime;    // å½’è¿˜æ—¶é—´
    private String status;               // çŠ¶æ€ï¼šBORROWEDï¼ˆå·²å€Ÿå‡ºï¼‰æˆ– RETURNEDï¼ˆå·²å½’è¿˜ï¼‰
}
```

**MyBatis-Plus æ³¨è§£è¯´æ˜**ï¼š
- `@TableName`ï¼šæŒ‡å®šå®ä½“ç±»å¯¹åº”çš„æ•°æ®åº“è¡¨åï¼ˆå¦‚æœç±»åä¸è¡¨åä¸€è‡´å¯çœç•¥ï¼‰
- `@TableId(type = IdType.AUTO)`ï¼šæ ‡è®°ä¸»é”®å­—æ®µï¼Œ`AUTO` è¡¨ç¤ºæ•°æ®åº“è‡ªå¢
- `@TableField`ï¼šæ˜ å°„å­—æ®µåï¼ˆå¦‚æœ Java å±æ€§åä¸æ•°æ®åº“å­—æ®µåä¸€è‡´å¯çœç•¥ï¼‰

### **æ­¥éª¤ 4.3**ï¼šåˆ›å»º Mapper æ¥å£
åœ¨ `src/main/java/com/example/library/mapper` åŒ…ä¸‹åˆ›å»ºä¸‰ä¸ªæ¥å£ï¼š

```java
// UserMapper.java
package com.example.library.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.example.library.entity.User;
import org.apache.ibatis.annotations.Mapper;

/**
 * ç”¨æˆ·æ•°æ®è®¿é—®æ¥å£
 * ç»§æ‰¿ BaseMapper åï¼Œè‡ªåŠ¨æ‹¥æœ‰å¢åˆ æ”¹æŸ¥æ–¹æ³•ï¼Œæ— éœ€ç¼–å†™ SQL
 */
@Mapper  // æ ‡è®°ä¸º MyBatis çš„ Mapper æ¥å£
public interface UserMapper extends BaseMapper<User> {
    // BaseMapper å·²æä¾›ä»¥ä¸‹æ–¹æ³•ï¼š
    // - insert(User user)ï¼šæ’å…¥ä¸€æ¡è®°å½•
    // - deleteById(Integer id)ï¼šæ ¹æ® ID åˆ é™¤
    // - updateById(User user)ï¼šæ ¹æ® ID æ›´æ–°
    // - selectById(Integer id)ï¼šæ ¹æ® ID æŸ¥è¯¢
    // - selectList(Wrapper)ï¼šæ¡ä»¶æŸ¥è¯¢
}
```

```java
// BookMapper.java
package com.example.library.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.example.library.entity.Book;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface BookMapper extends BaseMapper<Book> {
}
```

```java
// BorrowRecordMapper.java
package com.example.library.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.example.library.entity.BorrowRecord;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface BorrowRecordMapper extends BaseMapper<BorrowRecord> {
}
```

**MyBatis-Plus çš„æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- ä¼ ç»Ÿ MyBatis éœ€è¦åœ¨ XML æ–‡ä»¶ä¸­ç¼–å†™ SQL è¯­å¥
- MyBatis-Plus é€šè¿‡ç»§æ‰¿ `BaseMapper`ï¼Œè‡ªåŠ¨ç”Ÿæˆå¸¸ç”¨çš„ CRUD æ–¹æ³•
- å¤æ‚æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ `QueryWrapper` æ„å»ºæ¡ä»¶ï¼Œæ— éœ€æ‰‹å†™ SQL

---

## 5. ç™»å½•è®¤è¯ä¸æ‹¦æˆªå™¨å¼€å‘

### **æ­¥éª¤ 5.1**ï¼šåˆ›å»ºç™»å½•æ‹¦æˆªå™¨
åœ¨ `src/main/java/com/example/library/interceptor` åŒ…ä¸‹åˆ›å»º `LoginInterceptor.java`ï¼š

```java
package com.example.library.interceptor;

import cn.hutool.jwt.JWT;
import com.example.library.utils.JwtUtils;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.web.servlet.HandlerInterceptor;

/**
 * ç™»å½•æ‹¦æˆªå™¨
 * æ‹¦æˆªæ‰€æœ‰éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®çš„æ¥å£ï¼ŒéªŒè¯ Token æ˜¯å¦æœ‰æ•ˆ
 */
public class LoginInterceptor implements HandlerInterceptor {

    /**
     * åœ¨è¯·æ±‚åˆ°è¾¾ Controller ä¹‹å‰æ‰§è¡Œ
     * @return trueï¼šæ”¾è¡Œè¯·æ±‚ï¼›falseï¼šæ‹¦æˆªè¯·æ±‚
     */
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        // 1. æ”¾è¡Œ OPTIONS è¯·æ±‚ï¼ˆæµè§ˆå™¨è·¨åŸŸé¢„æ£€è¯·æ±‚ï¼‰
        if ("OPTIONS".equalsIgnoreCase(request.getMethod())) {
            return true;
        }

        // 2. ä»è¯·æ±‚å¤´ä¸­è·å– Token
        String token = request.getHeader("Authorization");

        // 3. éªŒè¯ Token æ ¼å¼ï¼ˆæ ‡å‡†æ ¼å¼ï¼šBearer <token>ï¼‰
        if (token != null && token.startsWith("Bearer ")) {
            token = token.substring(7); // å»æ‰ "Bearer " å‰ç¼€

            // 4. è§£æ Token
            JWT jwt = JwtUtils.parseToken(token);
            if (jwt != null) {
                // Token æœ‰æ•ˆï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ request åŸŸï¼Œä¾› Controller ä½¿ç”¨
                request.setAttribute("userId", ((Number) jwt.getPayload("userId")).intValue());
                request.setAttribute("role", jwt.getPayload("role"));
                return true; // æ”¾è¡Œ
            }
        }

        // 5. Token æ— æ•ˆæˆ–ä¸å­˜åœ¨ï¼Œè¿”å› 401 æœªæˆæƒ
        response.setStatus(401);
        response.setContentType("application/json;charset=UTF-8");
        response.getWriter().write("{\"code\":401,\"message\":\"æœªç™»å½•æˆ–ç™»å½•å·²è¿‡æœŸ\"}");
        return false; // æ‹¦æˆª
    }
}
```

**å…³é”®çŸ¥è¯†ç‚¹**ï¼š
- **æ‹¦æˆªå™¨çš„ä½œç”¨**ï¼šåœ¨è¯·æ±‚åˆ°è¾¾ Controller ä¹‹å‰è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼ˆå¦‚æƒé™éªŒè¯ã€æ—¥å¿—è®°å½•ï¼‰
- **ä¸ºä»€ä¹ˆè¦éªŒè¯ Token**ï¼šé˜²æ­¢æœªç™»å½•ç”¨æˆ·ç›´æ¥è®¿é—®éœ€è¦æƒé™çš„æ¥å£
- **request.setAttribute**ï¼šå°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥è¯·æ±‚åŸŸåï¼ŒController å¯ä»¥é€šè¿‡ `request.getAttribute("userId")` è·å–

### **æ­¥éª¤ 5.2**ï¼šæ³¨å†Œæ‹¦æˆªå™¨
åœ¨ `src/main/java/com/example/library/config` åŒ…ä¸‹åˆ›å»º `WebConfig.java`ï¼š

```java
package com.example.library.config;

import com.example.library.interceptor.LoginInterceptor;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * Web é…ç½®ç±»
 * ç”¨äºæ³¨å†Œæ‹¦æˆªå™¨å’Œé…ç½®è·¨åŸŸ
 */
@Configuration
public class WebConfig implements WebMvcConfigurer {

    /**
     * æ³¨å†Œæ‹¦æˆªå™¨
     */
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LoginInterceptor())
                .addPathPatterns("/api/**")        // æ‹¦æˆªæ‰€æœ‰ /api å¼€å¤´çš„è¯·æ±‚
                .excludePathPatterns("/api/login"); // æ”¾è¡Œç™»å½•æ¥å£
    }

    /**
     * é…ç½®è·¨åŸŸï¼ˆå…è®¸å‰ç«¯é¡µé¢è°ƒç”¨åç«¯æ¥å£ï¼‰
     */
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")  // å¯¹æ‰€æœ‰æ¥å£ç”Ÿæ•ˆ
                .allowedOriginPatterns("*")  // å…è®¸æ‰€æœ‰æ¥æº
                .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")  // å…è®¸çš„è¯·æ±‚æ–¹æ³•
                .allowedHeaders("*")  // å…è®¸æ‰€æœ‰è¯·æ±‚å¤´
                .allowCredentials(true)  // å…è®¸æºå¸¦ Cookie
                .maxAge(3600);  // é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼ˆ1å°æ—¶ï¼‰
    }
}
```

**é…ç½®è¯´æ˜**ï¼š
- `addPathPatterns("/api/**")`ï¼šæ‹¦æˆªæ‰€æœ‰ä»¥ `/api` å¼€å¤´çš„è¯·æ±‚
- `excludePathPatterns("/api/login")`ï¼šç™»å½•æ¥å£ä¸éœ€è¦éªŒè¯ Tokenï¼Œå¿…é¡»æ”¾è¡Œ
- **è·¨åŸŸé…ç½®**ï¼šå‰ç«¯é¡µé¢ï¼ˆå¦‚ `http://localhost:5500`ï¼‰è®¿é—®åç«¯æ¥å£ï¼ˆ`http://localhost:8080`ï¼‰æ—¶ï¼Œæµè§ˆå™¨ä¼šæ‹¦æˆªï¼Œéœ€è¦é…ç½®è·¨åŸŸ

---

## 6. æ§åˆ¶å™¨å±‚å¼€å‘

### **æ­¥éª¤ 6.1**ï¼šå®ç°ç™»å½•æ§åˆ¶å™¨
åœ¨ `src/main/java/com/example/library/controller` åŒ…ä¸‹åˆ›å»º `AuthController.java`ï¼š

```java
package com.example.library.controller;

import cn.hutool.core.bean.BeanUtil;
import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import com.example.library.common.Result;
import com.example.library.dto.LoginDTO;
import com.example.library.entity.User;
import com.example.library.mapper.UserMapper;
import com.example.library.utils.JwtUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.Map;

/**
 * è®¤è¯æ§åˆ¶å™¨
 * å¤„ç†ç™»å½•ç›¸å…³è¯·æ±‚
 */
@RestController
@RequestMapping("/api")
public class AuthController {

    @Autowired
    private UserMapper userMapper;

    /**
     * ç”¨æˆ·ç™»å½•æ¥å£
     * @param loginDTO å‰ç«¯æäº¤çš„ç™»å½•æ•°æ®ï¼ˆç”¨æˆ·åå’Œå¯†ç ï¼‰
     * @return ç™»å½•æˆåŠŸè¿”å› Token å’Œè§’è‰²ï¼Œå¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯
     */
    @PostMapping("/login")
    public Result<Map<String, Object>> login(@RequestBody LoginDTO loginDTO) {
        // 1. æ„å»ºæŸ¥è¯¢æ¡ä»¶ï¼ˆä½¿ç”¨ Lambda è¡¨è¾¾å¼ï¼Œé¿å…ç¡¬ç¼–ç å­—æ®µåï¼‰
        LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(User::getUsername, loginDTO.getUsername())  // ç”¨æˆ·ååŒ¹é…
               .eq(User::getPassword, loginDTO.getPassword()); // å¯†ç åŒ¹é…

        // 2. æŸ¥è¯¢æ•°æ®åº“
        User user = userMapper.selectOne(wrapper);

        // 3. éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        if (user == null) {
            return Result.error("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }

        // 4. ç”Ÿæˆ Token
        String token = JwtUtils.generateToken(user.getId(), user.getUsername(), user.getRole());

        // 5. å°è£…è¿”å›æ•°æ®
        Map<String, Object> data = new HashMap<>();
        data.put("token", token);
        data.put("role", user.getRole());
        data.put("username", user.getUsername());

        return Result.success(data);
    }
}
```

**å…³é”®çŸ¥è¯†ç‚¹**ï¼š
- **LambdaQueryWrapper**ï¼šMyBatis-Plus æä¾›çš„æ¡ä»¶æ„é€ å™¨ï¼Œä½¿ç”¨ Lambda è¡¨è¾¾å¼é¿å…å­—æ®µåå†™é”™
- **@RequestBody**ï¼šå°†å‰ç«¯æäº¤çš„ JSON æ•°æ®è‡ªåŠ¨è½¬æ¢ä¸º Java å¯¹è±¡
- **ä¸ºä»€ä¹ˆä¸ç›´æ¥è¿”å› User å¯¹è±¡**ï¼šå¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ä¸åº”è¯¥è¿”å›ç»™å‰ç«¯

### **æ­¥éª¤ 6.2**ï¼šå®ç°å›¾ä¹¦ç®¡ç†æ§åˆ¶å™¨
åœ¨ `src/main/java/com/example/library/controller` åŒ…ä¸‹åˆ›å»º `BookController.java`ï¼š

```java
package com.example.library.controller;

import com.example.library.common.Result;
import com.example.library.entity.Book;
import com.example.library.mapper.BookMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;

/**
 * å›¾ä¹¦ç®¡ç†æ§åˆ¶å™¨
 * æä¾›å›¾ä¹¦çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼ˆç®¡ç†å‘˜ä½¿ç”¨ï¼‰
 */
@RestController
@RequestMapping("/api/books")
public class BookController {

    @Autowired
    private BookMapper bookMapper;

    /**
     * æŸ¥è¯¢æ‰€æœ‰å›¾ä¹¦
     */
    @GetMapping
    public Result<List<Book>> getAllBooks() {
        List<Book> books = bookMapper.selectList(null); // null è¡¨ç¤ºæ— æ¡ä»¶æŸ¥è¯¢
        return Result.success(books);
    }

    /**
     * æ–°å¢å›¾ä¹¦
     */
    @PostMapping
    public Result<String> addBook(@RequestBody Book book) {
        // åˆå§‹åŒ–åº“å­˜ï¼šå‰©ä½™é‡ = æ€»é‡ï¼Œå·²å€Ÿå‡º = 0
        book.setAvailableQuantity(book.getTotalQuantity());
        book.setBorrowedQuantity(0);

        bookMapper.insert(book);
        return Result.success("æ·»åŠ æˆåŠŸ");
    }

    /**
     * æ›´æ–°å›¾ä¹¦ä¿¡æ¯
     */
    @PutMapping
    public Result<String> updateBook(@RequestBody Book book) {
        bookMapper.updateById(book); // æ ¹æ® ID æ›´æ–°
        return Result.success("æ›´æ–°æˆåŠŸ");
    }

    /**
     * åˆ é™¤å›¾ä¹¦
     */
    @DeleteMapping("/{id}")
    public Result<String> deleteBook(@PathVariable Integer id) {
        bookMapper.deleteById(id);
        return Result.success("åˆ é™¤æˆåŠŸ");
    }
}
```

**RESTful é£æ ¼è¯´æ˜**ï¼š
- `GET /api/books`ï¼šæŸ¥è¯¢æ‰€æœ‰å›¾ä¹¦
- `POST /api/books`ï¼šæ–°å¢å›¾ä¹¦
- `PUT /api/books`ï¼šæ›´æ–°å›¾ä¹¦
- `DELETE /api/books/{id}`ï¼šåˆ é™¤æŒ‡å®š ID çš„å›¾ä¹¦



### **æ­¥éª¤ 6.3**ï¼šå®ç°å€Ÿé˜…ç®¡ç†ä¸šåŠ¡å±‚ä¸æ§åˆ¶å™¨

ä¸ºäº†è®©ä»£ç ç»“æ„æ›´æ¸…æ™°ï¼Œæˆ‘ä»¬å°†å€Ÿé˜…ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚åº“å­˜æ£€æŸ¥ã€è®°å½•ç”Ÿæˆï¼‰ä» Controller ä¸­æŠ½ç¦»åˆ° Service å±‚ã€‚

**ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå€Ÿé˜…ä¸šåŠ¡ç±»**
åœ¨ `src/main/java/com/example/library/service` åŒ…ä¸‹åˆ›å»º `BorrowService.java`ï¼š

```java
package com.example.library.service;

import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import com.example.library.entity.Book;
import com.example.library.entity.BorrowRecord;
import com.example.library.mapper.BookMapper;
import com.example.library.mapper.BorrowRecordMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;
import java.util.List;

/**
 * å€Ÿé˜…ä¸šåŠ¡ç±»
 * å¤„ç†å€Ÿä¹¦ã€è¿˜ä¹¦çš„æ ¸å¿ƒé€»è¾‘
 */
@Service
public class BorrowService {

    @Autowired
    private BookMapper bookMapper;

    @Autowired
    private BorrowRecordMapper recordMapper;

    /**
     * å€Ÿä¹¦ä¸šåŠ¡é€»è¾‘
     * @param bookId å›¾ä¹¦ID
     * @param userId ç”¨æˆ·ID
     * @throws RuntimeException å½“å›¾ä¹¦ä¸å­˜åœ¨æˆ–åº“å­˜ä¸è¶³æ—¶æŠ›å‡ºå¼‚å¸¸
     */
    @Transactional  // å¼€å¯äº‹åŠ¡ï¼šç¡®ä¿åº“å­˜æ‰£å‡å’Œè®°å½•æ’å…¥è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥
    public void borrowBook(Integer bookId, Integer userId) {
        // 1. æŸ¥è¯¢å›¾ä¹¦ä¿¡æ¯
        Book book = bookMapper.selectById(bookId);
        if (book == null) {
            throw new RuntimeException("å›¾ä¹¦ä¸å­˜åœ¨");
        }

        // 2. æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
        if (book.getAvailableQuantity() <= 0) {
            throw new RuntimeException("åº“å­˜ä¸è¶³ï¼Œæ— æ³•å€Ÿé˜…");
        }

        // 3. æ‰£å‡åº“å­˜ï¼ˆå‰©ä½™é‡-1ï¼Œå·²å€Ÿå‡º+1ï¼‰
        book.setAvailableQuantity(book.getAvailableQuantity() - 1);
        book.setBorrowedQuantity(book.getBorrowedQuantity() + 1);
        bookMapper.updateById(book);

        // 4. ç”Ÿæˆå€Ÿé˜…è®°å½•
        BorrowRecord record = new BorrowRecord();
        record.setBookId(bookId);
        record.setUserId(userId);
        record.setBorrowTime(LocalDateTime.now());  // å½“å‰æ—¶é—´
        record.setStatus("BORROWED");  // çŠ¶æ€ï¼šå·²å€Ÿå‡º
        recordMapper.insert(record);
    }

    /**
     * æŸ¥è¯¢ç”¨æˆ·çš„å€Ÿé˜…è®°å½•
     * @param userId ç”¨æˆ·ID
     * @return è¯¥ç”¨æˆ·çš„æ‰€æœ‰å€Ÿé˜…è®°å½•ï¼ˆæŒ‰æ—¶é—´å€’åºï¼‰
     */
    public List<BorrowRecord> getMyRecords(Integer userId) {
        LambdaQueryWrapper<BorrowRecord> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(BorrowRecord::getUserId, userId)
               .orderByDesc(BorrowRecord::getBorrowTime);  // æŒ‰å€Ÿé˜…æ—¶é—´å€’åºæ’åˆ—
        return recordMapper.selectList(wrapper);
    }

    /**
     * è¿˜ä¹¦ä¸šåŠ¡é€»è¾‘
     * @param recordId å€Ÿé˜…è®°å½•ID
     * @throws RuntimeException å½“è®°å½•ä¸å­˜åœ¨æˆ–å·²å½’è¿˜æ—¶æŠ›å‡ºå¼‚å¸¸
     */
    @Transactional  // å¼€å¯äº‹åŠ¡
    public void returnBook(Integer recordId) {
        // 1. æŸ¥è¯¢å€Ÿé˜…è®°å½•
        BorrowRecord record = recordMapper.selectById(recordId);
        if (record == null) {
            throw new RuntimeException("å€Ÿé˜…è®°å½•ä¸å­˜åœ¨");
        }

        // 2. æ£€æŸ¥æ˜¯å¦å·²å½’è¿˜
        if ("RETURNED".equals(record.getStatus())) {
            throw new RuntimeException("è¯¥ä¹¦å·²å½’è¿˜ï¼Œè¯·å‹¿é‡å¤æ“ä½œ");
        }

        // 3. æ›´æ–°å€Ÿé˜…è®°å½•çŠ¶æ€
        record.setStatus("RETURNED");
        record.setReturnTime(LocalDateTime.now());  // è®°å½•å½’è¿˜æ—¶é—´
        recordMapper.updateById(record);

        // 4. æ¢å¤å›¾ä¹¦åº“å­˜ï¼ˆå‰©ä½™é‡+1ï¼Œå·²å€Ÿå‡º-1ï¼‰
        Book book = bookMapper.selectById(record.getBookId());
        book.setAvailableQuantity(book.getAvailableQuantity() + 1);
        book.setBorrowedQuantity(book.getBorrowedQuantity() - 1);
        bookMapper.updateById(book);
    }

    /**
     * æŸ¥è¯¢æ‰€æœ‰å€Ÿé˜…è®°å½•ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
     * @return æ‰€æœ‰å€Ÿé˜…è®°å½•
     */
    public List<BorrowRecord> getAllRecords() {
        return recordMapper.selectList(null);
    }
}
```

**ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå€Ÿé˜…æ§åˆ¶å™¨**
åœ¨ `src/main/java/com/example/library/controller` åŒ…ä¸‹åˆ›å»º `BorrowController.java`ï¼š

```java
package com.example.library.controller;

import com.example.library.common.Result;
import com.example.library.entity.BorrowRecord;
import com.example.library.service.BorrowService;
import jakarta.servlet.http.HttpServletRequest;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;

/**
 * å€Ÿé˜…ç®¡ç†æ§åˆ¶å™¨
 * å¤„ç†å€Ÿä¹¦ã€è¿˜ä¹¦ã€æŸ¥è¯¢å€Ÿé˜…è®°å½•ç­‰è¯·æ±‚
 */
@RestController
@RequestMapping("/api/borrow")
public class BorrowController {

    @Autowired
    private BorrowService borrowService;

    /**
     * å€Ÿä¹¦æ¥å£
     * @param bookId è¦å€Ÿçš„å›¾ä¹¦ID
     * @param request è¯·æ±‚å¯¹è±¡ï¼ˆä»ä¸­è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„IDï¼‰
     * @return å€Ÿé˜…ç»“æœ
     */
    @PostMapping("/{bookId}")
    public Result<String> borrowBook(@PathVariable Integer bookId, HttpServletRequest request) {
        try {
            // ä»æ‹¦æˆªå™¨å­˜å…¥çš„ request åŸŸä¸­è·å–å½“å‰ç”¨æˆ·ID
            Integer userId = (Integer) request.getAttribute("userId");

            // è°ƒç”¨ä¸šåŠ¡å±‚å¤„ç†å€Ÿä¹¦é€»è¾‘
            borrowService.borrowBook(bookId, userId);

            return Result.success("å€Ÿé˜…æˆåŠŸ");
        } catch (RuntimeException e) {
            // æ•è·ä¸šåŠ¡å±‚æŠ›å‡ºçš„å¼‚å¸¸ï¼ˆå¦‚åº“å­˜ä¸è¶³ã€å›¾ä¹¦ä¸å­˜åœ¨ï¼‰
            return Result.error(e.getMessage());
        }
    }

    /**
     * æŸ¥è¯¢æˆ‘çš„å€Ÿé˜…è®°å½•
     * @param request è¯·æ±‚å¯¹è±¡ï¼ˆè·å–å½“å‰ç”¨æˆ·IDï¼‰
     * @return å½“å‰ç”¨æˆ·çš„æ‰€æœ‰å€Ÿé˜…è®°å½•
     */
    @GetMapping("/my")
    public Result<List<BorrowRecord>> getMyRecords(HttpServletRequest request) {
        Integer userId = (Integer) request.getAttribute("userId");
        List<BorrowRecord> records = borrowService.getMyRecords(userId);
        return Result.success(records);
    }

    /**
     * è¿˜ä¹¦æ¥å£
     * @param recordId å€Ÿé˜…è®°å½•ID
     * @return å½’è¿˜ç»“æœ
     */
    @PostMapping("/return/{recordId}")
    public Result<String> returnBook(@PathVariable Integer recordId) {
        try {
            // è°ƒç”¨ä¸šåŠ¡å±‚å¤„ç†è¿˜ä¹¦é€»è¾‘
            borrowService.returnBook(recordId);

            return Result.success("å½’è¿˜æˆåŠŸ");
        } catch (RuntimeException e) {
            // æ•è·ä¸šåŠ¡å±‚æŠ›å‡ºçš„å¼‚å¸¸ï¼ˆå¦‚è®°å½•ä¸å­˜åœ¨ã€å·²å½’è¿˜ï¼‰
            return Result.error(e.getMessage());
        }
    }

    /**
     * æŸ¥è¯¢æ‰€æœ‰å€Ÿé˜…è®°å½•ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
     * @return æ‰€æœ‰å€Ÿé˜…è®°å½•
     */
    @GetMapping("/all")
    public Result<List<BorrowRecord>> getAllRecords() {
        List<BorrowRecord> records = borrowService.getAllRecords();
        return Result.success(records);
    }
}
```

**å…³é”®çŸ¥è¯†ç‚¹**ï¼š
- **ä¸ºä»€ä¹ˆè¦åˆ†å±‚**ï¼šController åªè´Ÿè´£æ¥æ”¶è¯·æ±‚å’Œè¿”å›å“åº”ï¼ŒService è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼ŒMapper è´Ÿè´£æ•°æ®åº“æ“ä½œã€‚è¿™æ ·ä»£ç æ›´æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤å’Œæµ‹è¯•
- **@Transactional çš„ä½ç½®**ï¼šäº‹åŠ¡æ³¨è§£åº”è¯¥åŠ åœ¨ Service å±‚çš„æ–¹æ³•ä¸Šï¼Œè€Œä¸æ˜¯ Controller å±‚ï¼Œå› ä¸ºäº‹åŠ¡ç®¡ç†çš„æ˜¯ä¸šåŠ¡é€»è¾‘
- **å¼‚å¸¸å¤„ç†æœºåˆ¶**ï¼šService å±‚é€šè¿‡ `throw new RuntimeException()` æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸ï¼ŒController å±‚é€šè¿‡ `try-catch` æ•è·å¹¶è½¬æ¢ä¸ºç»Ÿä¸€çš„å“åº”æ ¼å¼
- **request.getAttribute("userId")**ï¼šä»æ‹¦æˆªå™¨ä¸­è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„IDï¼Œé¿å…å‰ç«¯ä¼ªé€ ç”¨æˆ·èº«ä»½

> æ³¨ï¼šå‰ç«¯å¦‚æœè¦å’Œæˆ‘æœ‰å¼‚åŒï¼Œè¯·åŸºäºä»¥ä¸‹çš„æ¥å£æ–‡æ¡£å‘é€ç»™ä½ ä½¿ç”¨çš„å¤§æ¨¡å‹ï¼Œè®©ä»–åŸºäºæ­¤æ¥å£ï¼Œå¹¶é‡‡ç”¨
>
> ğŸ¨ **Tailwind CSS**: ç°ä»£å¸ƒå±€ã€‚
>
> âœ¨ **AutoAnimate**: åˆ—è¡¨å¢åˆ æ—¶çš„ä¸æ»‘ç§»ä½åŠ¨ç”»ã€‚
>
> ğŸš€ **NProgress**: é¡¶éƒ¨çš„çº¢è‰²åŠ è½½æ¡ï¼ˆç‚¹å‡»ç™»å½•æ—¶æ³¨æ„çœ‹é¡¶éƒ¨ï¼‰ã€‚
>
> ğŸ”” **SweetAlert2**: æ¼‚äº®çš„å¼¹çª—ã€‚
>
> ğŸ§© **Alpine.js**: é©±åŠ¨æ‰€æœ‰é€»è¾‘
>
> ä»¥ä¸‹æŠ€æœ¯æ ˆå»å¯¹æ¥å†…å®¹å³å¯

### æ­¥éª¤ 6.4ï¼šç¼–å†™è®¤è¯æ¥å£æ–‡æ¡£

#### 6.4.1. ç”¨æˆ·ç™»å½•

**æ¥å£åœ°å€**ï¼š`POST /api/login`

**æ¥å£è¯´æ˜**ï¼šç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç³»ç»Ÿï¼ŒæˆåŠŸåè¿”å› Token ç”¨äºåç»­è¯·æ±‚è®¤è¯ã€‚

**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å     | ç±»å‹   | å¿…å¡« | è¯´æ˜   |
| ---------- | ------ | ---- | ------ |
| `username` | String | æ˜¯   | ç”¨æˆ·å |
| `password` | String | æ˜¯   | å¯†ç    |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "username": "admin",
  "password": "admin123"
}
```

**å“åº”å‚æ•°**ï¼š

| å‚æ•°å    | ç±»å‹    | è¯´æ˜                       |
| --------- | ------- | -------------------------- |
| `code`    | Integer | çŠ¶æ€ç ï¼ˆ200 æˆåŠŸï¼Œ400 å¤±è´¥ï¼‰ |
| `message` | String  | æç¤ºä¿¡æ¯                   |
| `data`    | Object  | è¿”å›æ•°æ®å¯¹è±¡               |
| â”œâ”€ `token`    | String  | JWT Tokenï¼ˆæœ‰æ•ˆæœŸ 24 å°æ—¶ï¼‰ |
| â”œâ”€ `role`     | String  | ç”¨æˆ·è§’è‰²ï¼ˆADMIN/USERï¼‰      |
| â””â”€ `username` | String  | ç”¨æˆ·å                     |

**æˆåŠŸå“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "role": "ADMIN",
    "username": "admin"
  }
}
```

**å¤±è´¥å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 400,
  "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯",
  "data": null
}
```

---

#### 6.4.2 å›¾ä¹¦ç®¡ç†æ¥å£

##### 2. æŸ¥è¯¢æ‰€æœ‰å›¾ä¹¦

**æ¥å£åœ°å€**ï¼š`GET /api/books`

**æ¥å£è¯´æ˜**ï¼šè·å–ç³»ç»Ÿä¸­æ‰€æœ‰å›¾ä¹¦çš„åˆ—è¡¨ä¿¡æ¯ã€‚

**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯ï¼ˆéœ€åœ¨è¯·æ±‚å¤´æºå¸¦ Tokenï¼‰

**è¯·æ±‚å¤´**ï¼š

| å‚æ•°å          | ç±»å‹   | å¿…å¡« | è¯´æ˜                          |
| --------------- | ------ | ---- | ----------------------------- |
| `Authorization` | String | æ˜¯   | æ ¼å¼ï¼š`Bearer <token>` |

**è¯·æ±‚å‚æ•°**ï¼šæ— 

**å“åº”å‚æ•°**ï¼š

| å‚æ•°å    | ç±»å‹    | è¯´æ˜                       |
| --------- | ------- | -------------------------- |
| `code`    | Integer | çŠ¶æ€ç ï¼ˆ200 æˆåŠŸï¼Œ400 å¤±è´¥ï¼‰ |
| `message` | String  | æç¤ºä¿¡æ¯                   |
| `data`    | Array   | å›¾ä¹¦åˆ—è¡¨                   |
| â”œâ”€ `id`                 | Integer | å›¾ä¹¦ID                     |
| â”œâ”€ `title`              | String  | ä¹¦å                       |
| â”œâ”€ `author`             | String  | ä½œè€…                       |
| â”œâ”€ `publisher`          | String  | å‡ºç‰ˆç¤¾                     |
| â”œâ”€ `totalQuantity`      | Integer | æ€»åº“å­˜                     |
| â”œâ”€ `borrowedQuantity`   | Integer | å·²å€Ÿå‡ºæ•°é‡                 |
| â””â”€ `availableQuantity`  | Integer | å‰©ä½™åº“å­˜                   |

**æˆåŠŸå“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": [
    {
      "id": 1,
      "title": "Javaç¼–ç¨‹æ€æƒ³",
      "author": "Bruce Eckel",
      "publisher": "æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾",
      "totalQuantity": 10,
      "borrowedQuantity": 2,
      "availableQuantity": 8
    },
    {
      "id": 2,
      "title": "æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ",
      "author": "Randal E. Bryant",
      "publisher": "æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾",
      "totalQuantity": 5,
      "borrowedQuantity": 0,
      "availableQuantity": 5
    }
  ]
}
```

---

##### 3. æ–°å¢å›¾ä¹¦

**æ¥å£åœ°å€**ï¼š`POST /api/books`

**æ¥å£è¯´æ˜**ï¼šç®¡ç†å‘˜æ·»åŠ æ–°å›¾ä¹¦åˆ°ç³»ç»Ÿï¼ˆè‡ªåŠ¨åˆå§‹åŒ–åº“å­˜å­—æ®µï¼‰ã€‚

**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**è¯·æ±‚å¤´**ï¼šåŒä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å          | ç±»å‹    | å¿…å¡« | è¯´æ˜                                   |
| --------------- | ------- | ---- | -------------------------------------- |
| `title`         | String  | æ˜¯   | ä¹¦å                                   |
| `author`        | String  | å¦   | ä½œè€…                                   |
| `publisher`     | String  | å¦   | å‡ºç‰ˆç¤¾                                 |
| `totalQuantity` | Integer | æ˜¯   | æ€»åº“å­˜ï¼ˆç³»ç»Ÿè‡ªåŠ¨å°†å‰©ä½™åº“å­˜è®¾ä¸ºæ­¤å€¼ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "title": "Effective Java",
  "author": "Joshua Bloch",
  "publisher": "æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾",
  "totalQuantity": 15
}
```

**å“åº”å‚æ•°**ï¼š

| å‚æ•°å    | ç±»å‹    | è¯´æ˜                       |
| --------- | ------- | -------------------------- |
| `code`    | Integer | çŠ¶æ€ç ï¼ˆ200 æˆåŠŸï¼Œ400 å¤±è´¥ï¼‰ |
| `message` | String  | æç¤ºä¿¡æ¯                   |
| `data`    | String  | è¿”å›æ¶ˆæ¯                   |

**æˆåŠŸå“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "æ·»åŠ æˆåŠŸ"
}
```

---

##### 4. æ›´æ–°å›¾ä¹¦ä¿¡æ¯

**æ¥å£åœ°å€**ï¼š`PUT /api/books`

**æ¥å£è¯´æ˜**ï¼šæ ¹æ®å›¾ä¹¦ ID æ›´æ–°å›¾ä¹¦ä¿¡æ¯ã€‚

**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**è¯·æ±‚å¤´**ï¼šåŒä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å              | ç±»å‹    | å¿…å¡« | è¯´æ˜                       |
| ------------------- | ------- | ---- | -------------------------- |
| `id`                | Integer | æ˜¯   | å›¾ä¹¦IDï¼ˆç”¨äºå®šä½è¦æ›´æ–°çš„è®°å½•ï¼‰ |
| `title`             | String  | å¦   | ä¹¦å                       |
| `author`            | String  | å¦   | ä½œè€…                       |
| `publisher`         | String  | å¦   | å‡ºç‰ˆç¤¾                     |
| `totalQuantity`     | Integer | å¦   | æ€»åº“å­˜                     |
| `borrowedQuantity`  | Integer | å¦   | å·²å€Ÿå‡ºæ•°é‡                 |
| `availableQuantity` | Integer | å¦   | å‰©ä½™åº“å­˜                   |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "id": 1,
  "title": "Javaç¼–ç¨‹æ€æƒ³ï¼ˆç¬¬4ç‰ˆï¼‰",
  "totalQuantity": 12
}
```

**æˆåŠŸå“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "æ›´æ–°æˆåŠŸ"
}
```

---

##### 5. åˆ é™¤å›¾ä¹¦

**æ¥å£åœ°å€**ï¼š`DELETE /api/books/{id}`

**æ¥å£è¯´æ˜**ï¼šæ ¹æ®å›¾ä¹¦ ID åˆ é™¤å›¾ä¹¦è®°å½•ã€‚

**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**è¯·æ±‚å¤´**ï¼šåŒä¸Š

**è·¯å¾„å‚æ•°**ï¼š

| å‚æ•°å | ç±»å‹    | å¿…å¡« | è¯´æ˜   |
| ------ | ------- | ---- | ------ |
| `id`   | Integer | æ˜¯   | å›¾ä¹¦ID |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```
DELETE /api/books/3
```

**æˆåŠŸå“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "åˆ é™¤æˆåŠŸ"
}
```

---

#### 6.4.3 å€Ÿé˜…ç®¡ç†æ¥å£

##### 6. å€Ÿä¹¦

**æ¥å£åœ°å€**ï¼š`POST /api/borrow/{bookId}`

**æ¥å£è¯´æ˜**ï¼šç”¨æˆ·å€Ÿé˜…æŒ‡å®šå›¾ä¹¦ï¼ˆè‡ªåŠ¨æ‰£å‡åº“å­˜å¹¶ç”Ÿæˆå€Ÿé˜…è®°å½•ï¼‰ã€‚

**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**è¯·æ±‚å¤´**ï¼šåŒä¸Š

**è·¯å¾„å‚æ•°**ï¼š

| å‚æ•°å   | ç±»å‹    | å¿…å¡« | è¯´æ˜   |
| -------- | ------- | ---- | ------ |
| `bookId` | Integer | æ˜¯   | å›¾ä¹¦ID |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```
POST /api/borrow/1
```

**å“åº”å‚æ•°**ï¼š

| å‚æ•°å    | ç±»å‹    | è¯´æ˜                       |
| --------- | ------- | -------------------------- |
| `code`    | Integer | çŠ¶æ€ç ï¼ˆ200 æˆåŠŸï¼Œ400 å¤±è´¥ï¼‰ |
| `message` | String  | æç¤ºä¿¡æ¯                   |
| `data`    | String  | è¿”å›æ¶ˆæ¯                   |

**æˆåŠŸå“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "å€Ÿé˜…æˆåŠŸ"
}
```

**å¤±è´¥å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 400,
  "message": "åº“å­˜ä¸è¶³ï¼Œæ— æ³•å€Ÿé˜…",
  "data": null
}
```

---

##### 7. æŸ¥è¯¢æˆ‘çš„å€Ÿé˜…è®°å½•

**æ¥å£åœ°å€**ï¼š`GET /api/borrow/my`

**æ¥å£è¯´æ˜**ï¼šæŸ¥è¯¢å½“å‰ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰å€Ÿé˜…è®°å½•ï¼ˆæŒ‰å€Ÿé˜…æ—¶é—´å€’åºï¼‰ã€‚

**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**è¯·æ±‚å¤´**ï¼šåŒä¸Š

**è¯·æ±‚å‚æ•°**ï¼šæ— 

**å“åº”å‚æ•°**ï¼š

| å‚æ•°å    | ç±»å‹    | è¯´æ˜                       |
| --------- | ------- | -------------------------- |
| `code`    | Integer | çŠ¶æ€ç ï¼ˆ200 æˆåŠŸï¼Œ400 å¤±è´¥ï¼‰ |
| `message` | String  | æç¤ºä¿¡æ¯                   |
| `data`    | Array   | å€Ÿé˜…è®°å½•åˆ—è¡¨               |
| â”œâ”€ `id`          | Integer  | å€Ÿé˜…è®°å½•ID                 |
| â”œâ”€ `bookId`      | Integer  | å›¾ä¹¦ID                     |
| â”œâ”€ `userId`      | Integer  | ç”¨æˆ·ID                     |
| â”œâ”€ `borrowTime`  | DateTime | å€Ÿé˜…æ—¶é—´                   |
| â”œâ”€ `returnTime`  | DateTime | å½’è¿˜æ—¶é—´ï¼ˆæœªå½’è¿˜æ—¶ä¸º nullï¼‰ |
| â””â”€ `status`      | String   | çŠ¶æ€ï¼ˆBORROWED/RETURNEDï¼‰  |

**æˆåŠŸå“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": [
    {
      "id": 5,
      "bookId": 1,
      "userId": 2,
      "borrowTime": "2025-01-15T10:30:00",
      "returnTime": null,
      "status": "BORROWED"
    },
    {
      "id": 3,
      "bookId": 2,
      "userId": 2,
      "borrowTime": "2025-01-10T14:20:00",
      "returnTime": "2025-01-12T09:15:00",
      "status": "RETURNED"
    }
  ]
}
```

---

##### 8. è¿˜ä¹¦

**æ¥å£åœ°å€**ï¼š`POST /api/borrow/return/{recordId}`

**æ¥å£è¯´æ˜**ï¼šç”¨æˆ·å½’è¿˜å›¾ä¹¦ï¼ˆè‡ªåŠ¨æ¢å¤åº“å­˜å¹¶æ›´æ–°å€Ÿé˜…è®°å½•çŠ¶æ€ï¼‰ã€‚

**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**è¯·æ±‚å¤´**ï¼šåŒä¸Š

**è·¯å¾„å‚æ•°**ï¼š

| å‚æ•°å     | ç±»å‹    | å¿…å¡« | è¯´æ˜       |
| ---------- | ------- | ---- | ---------- |
| `recordId` | Integer | æ˜¯   | å€Ÿé˜…è®°å½•ID |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```
POST /api/borrow/return/5
```

**æˆåŠŸå“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "å½’è¿˜æˆåŠŸ"
}
```

**å¤±è´¥å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 400,
  "message": "è¯¥ä¹¦å·²å½’è¿˜ï¼Œè¯·å‹¿é‡å¤æ“ä½œ",
  "data": null
}
```

---

##### 9. æŸ¥è¯¢æ‰€æœ‰å€Ÿé˜…è®°å½•ï¼ˆç®¡ç†å‘˜ï¼‰

**æ¥å£åœ°å€**ï¼š`GET /api/borrow/all`

**æ¥å£è¯´æ˜**ï¼šç®¡ç†å‘˜æŸ¥è¯¢ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„å€Ÿé˜…è®°å½•ã€‚

**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**è¯·æ±‚å¤´**ï¼šåŒä¸Š

**è¯·æ±‚å‚æ•°**ï¼šæ— 

**å“åº”å‚æ•°**ï¼šåŒæ¥å£ 7ï¼ˆè¿”å›æ‰€æœ‰ç”¨æˆ·çš„è®°å½•ï¼‰

**æˆåŠŸå“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": [
    {
      "id": 1,
      "bookId": 1,
      "userId": 1,
      "borrowTime": "2025-01-01T08:00:00",
      "returnTime": "2025-01-05T10:00:00",
      "status": "RETURNED"
    },
    {
      "id": 2,
      "bookId": 2,
      "userId": 2,
      "borrowTime": "2025-01-10T14:20:00",
      "returnTime": null,
      "status": "BORROWED"
    }
  ]
}
```

---

#### 6.4.4 é€šç”¨é”™è¯¯å“åº”

å½“è¯·æ±‚å‡ºç°å¼‚å¸¸æ—¶ï¼ˆå¦‚ Token æ— æ•ˆã€å‚æ•°é”™è¯¯ã€æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼‰ï¼Œç³»ç»Ÿè¿”å›ç»Ÿä¸€çš„é”™è¯¯æ ¼å¼ï¼š

**æœªç™»å½•æˆ– Token è¿‡æœŸ**ï¼š

```json
{
  "code": 401,
  "message": "æœªç™»å½•æˆ–ç™»å½•å·²è¿‡æœŸ",
  "data": null
}
```

**ä¸šåŠ¡é€»è¾‘é”™è¯¯**ï¼š

```json
{
  "code": 400,
  "message": "å…·ä½“é”™è¯¯åŸå› ï¼ˆå¦‚ï¼šå›¾ä¹¦ä¸å­˜åœ¨ã€åº“å­˜ä¸è¶³ï¼‰",
  "data": null
}
```

---

#### 6.4.5 æ¥å£æµ‹è¯•è¯´æ˜

**ä½¿ç”¨ Postman æµ‹è¯•æ­¥éª¤**ï¼š

1. è°ƒç”¨ç™»å½•æ¥å£è·å– Token
2. åœ¨åç»­è¯·æ±‚çš„ Headers ä¸­æ·»åŠ ï¼š
   - Key: `Authorization`
   - Value: `Bearer <ç™»å½•è¿”å›çš„token>`
3. å‘é€è¯·æ±‚å¹¶æŸ¥çœ‹å“åº”ç»“æœ

**æ³¨æ„äº‹é¡¹**ï¼š
- æ‰€æœ‰éœ€è¦è®¤è¯çš„æ¥å£å¿…é¡»æºå¸¦æœ‰æ•ˆçš„ Token
- Token æœ‰æ•ˆæœŸä¸º 24 å°æ—¶ï¼Œè¿‡æœŸåéœ€é‡æ–°ç™»å½•
- åˆ é™¤å›¾ä¹¦å‰è¯·ç¡®ä¿è¯¥å›¾ä¹¦æ²¡æœ‰æœªå½’è¿˜çš„å€Ÿé˜…è®°å½•ï¼ˆå¦åˆ™ä¼šå› å¤–é”®çº¦æŸå¯¼è‡´åˆ é™¤å¤±è´¥ï¼‰


---

## 7. å‰ç«¯é¡µé¢å¼€å‘

åœ¨å®Œæˆåç«¯æ¥å£å¼€å‘åï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºå‰ç«¯é¡µé¢ä¸åç«¯è¿›è¡Œäº¤äº’ã€‚æœ¬ç« å°†è¯¦ç»†è®²è§£å¦‚ä½•æ­å»ºä¸€ä¸ªç»“æ„æ¸…æ™°ã€æ˜“äºç»´æŠ¤çš„å‰ç«¯é¡¹ç›®ã€‚

---

### 7.1 ä¸ºä»€ä¹ˆè¦å‰åç«¯åˆ†ç¦»ï¼Ÿ

åœ¨ä¼ ç»Ÿçš„ Web å¼€å‘ä¸­ï¼Œå‰ç«¯é¡µé¢é€šå¸¸æ”¾åœ¨åç«¯é¡¹ç›®çš„ `src/main/resources/static` ç›®å½•ä¸‹ï¼Œè¿™ç§æ–¹å¼å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

**å¼€å‘æ•ˆç‡é—®é¢˜**ï¼š
- å‰ç«¯ä¿®æ”¹ä¸€ä¸ªæ ·å¼ï¼Œéœ€è¦é‡å¯æ•´ä¸ª Spring Boot é¡¹ç›®æ‰èƒ½çœ‹åˆ°æ•ˆæœ
- å‰ç«¯å¼€å‘è€…å¿…é¡»é…ç½® Java å¼€å‘ç¯å¢ƒï¼ˆJDKã€Mavenï¼‰ï¼Œå­¦ä¹ æˆæœ¬é«˜
- å‰åç«¯å¼€å‘è€…æ— æ³•å¹¶è¡Œå·¥ä½œï¼Œå¿…é¡»ç­‰å¾…å¯¹æ–¹å®Œæˆ

**éƒ¨ç½²çµæ´»æ€§é—®é¢˜**ï¼š
- å‰ç«¯å’Œåç«¯å¿…é¡»éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Š
- æ— æ³•ä½¿ç”¨ CDN åŠ é€Ÿå‰ç«¯é™æ€èµ„æº
- å‰ç«¯æ›´æ–°éœ€è¦é‡æ–°æ‰“åŒ…æ•´ä¸ªåç«¯é¡¹ç›®

**æŠ€æœ¯æ ˆé™åˆ¶**ï¼š
- å‰ç«¯æ— æ³•ä½¿ç”¨ç°ä»£åŒ–çš„æ„å»ºå·¥å…·ï¼ˆViteã€Webpackï¼‰
- æ— æ³•ä½¿ç”¨å‰ç«¯æ¡†æ¶çš„è„šæ‰‹æ¶å·¥å…·ï¼ˆVue CLIã€Create React Appï¼‰

**å‰åç«¯åˆ†ç¦»çš„ä¼˜åŠ¿**ï¼š
- **ç‹¬ç«‹å¼€å‘**ï¼šå‰ç«¯å’Œåç«¯å¯ä»¥åŒæ—¶å¼€å‘ï¼Œäº’ä¸å¹²æ‰°
- **ç‹¬ç«‹éƒ¨ç½²**ï¼šå‰ç«¯å¯ä»¥éƒ¨ç½²åˆ° Nginxã€CDN ç­‰é™æ€æœåŠ¡å™¨ï¼Œåç«¯éƒ¨ç½²åˆ°åº”ç”¨æœåŠ¡å™¨
- **æŠ€æœ¯è§£è€¦**ï¼šå‰ç«¯å¯ä»¥è‡ªç”±é€‰æ‹©æŠ€æœ¯æ ˆï¼ˆVueã€Reactã€Angularï¼‰ï¼Œåç«¯ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå‰ç«¯é™æ€èµ„æºå¯ä»¥ä½¿ç”¨ CDN åŠ é€Ÿï¼Œå‡è½»åç«¯æœåŠ¡å™¨å‹åŠ›

---

### 7.2 å‰ç«¯é¡¹ç›®ç›®å½•è§„åˆ’

#### **æ­¥éª¤ 7.2.1**ï¼šåˆ›å»ºå‰ç«¯é¡¹ç›®æ ¹ç›®å½•

åœ¨åç«¯é¡¹ç›® `library` çš„ **åŒçº§ç›®å½•** ä¸‹åˆ›å»º `library-frontend` æ–‡ä»¶å¤¹ï¼š

```
å·¥ä½œç©ºé—´/
â”œâ”€â”€ library/                  # åç«¯é¡¹ç›®ï¼ˆSpring Bootï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ ...
â””â”€â”€ library-frontend/         # å‰ç«¯é¡¹ç›®ï¼ˆç‹¬ç«‹éƒ¨ç½²ï¼‰
    â””â”€â”€ (å¾…åˆ›å»ºçš„æ–‡ä»¶)
```

#### **æ­¥éª¤ 7.2.2**ï¼šè§„åˆ’å‰ç«¯ç›®å½•ç»“æ„

åœ¨ `library-frontend` ç›®å½•ä¸‹åˆ›å»ºä»¥ä¸‹ç»“æ„ï¼š

```
library-frontend/
â”œâ”€â”€ pages/                    # é¡µé¢ç›®å½•ï¼ˆæ¯ä¸ªé¡µé¢ä¸€ä¸ª HTML æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ login.html            # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ admin/                # ç®¡ç†å‘˜é¡µé¢ç›®å½•
â”‚   â”‚   â”œâ”€â”€ books.html        # å›¾ä¹¦ç®¡ç†é¡µé¢
â”‚   â”‚   â””â”€â”€ records.html      # å€Ÿé˜…æ€»è§ˆé¡µé¢
â”‚   â””â”€â”€ user/                 # ç”¨æˆ·é¡µé¢ç›®å½•
â”‚       â”œâ”€â”€ books.html        # å›¾ä¹¦å€Ÿé˜…é¡µé¢
â”‚       â””â”€â”€ records.html      # æˆ‘çš„å€Ÿé˜…è®°å½•é¡µé¢
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ config.js             # å…¨å±€é…ç½®ï¼ˆAPI åœ°å€ã€å¸¸é‡ï¼‰
â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°ç›®å½•
â”‚   â”‚   â”œâ”€â”€ http.js           # HTTP è¯·æ±‚å°è£…
â”‚   â”‚   â””â”€â”€ storage.js        # æœ¬åœ°å­˜å‚¨å°è£…
â”‚   â”œâ”€â”€ api/                  # API æ¥å£ç›®å½•ï¼ˆæŒ‰ä¸šåŠ¡æ¨¡å—æ‹†åˆ†ï¼‰
â”‚   â”‚   â”œâ”€â”€ auth.js           # è®¤è¯æ¥å£ï¼ˆç™»å½•ã€ç™»å‡ºï¼‰
â”‚   â”‚   â”œâ”€â”€ book.js           # å›¾ä¹¦ç®¡ç†æ¥å£
â”‚   â”‚   â””â”€â”€ borrow.js         # å€Ÿé˜…ç®¡ç†æ¥å£
â”‚   â””â”€â”€ modules/              # ä¸šåŠ¡é€»è¾‘æ¨¡å—ï¼ˆæ¯ä¸ªé¡µé¢å¯¹åº”ä¸€ä¸ª JS æ–‡ä»¶ï¼‰
â”‚       â”œâ”€â”€ login.js          # ç™»å½•é¡µé¢é€»è¾‘
â”‚       â”œâ”€â”€ admin-books.js    # ç®¡ç†å‘˜-å›¾ä¹¦ç®¡ç†é€»è¾‘
â”‚       â”œâ”€â”€ admin-records.js  # ç®¡ç†å‘˜-å€Ÿé˜…æ€»è§ˆé€»è¾‘
â”‚       â”œâ”€â”€ user-books.js     # ç”¨æˆ·-å›¾ä¹¦å€Ÿé˜…é€»è¾‘
â”‚       â””â”€â”€ user-records.js   # ç”¨æˆ·-æˆ‘çš„è®°å½•é€»è¾‘
â”œâ”€â”€ css/
â”‚   â””â”€â”€ common.css            # å…¬å…±æ ·å¼ï¼ˆå¯é€‰ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨ Tailwind CDNï¼‰
â”œâ”€â”€ assets/                   # é™æ€èµ„æº
â”‚   â””â”€â”€ logo.png              # ç½‘ç«™ Logo
â””â”€â”€ index.html                # å…¥å£é¡µé¢ï¼ˆè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µæˆ–ç³»ç»Ÿé¡µï¼‰
```

**ç›®å½•è®¾è®¡åŸåˆ™**ï¼š

| ç›®å½• | èŒè´£ | è®¾è®¡åŸåˆ™ |
|------|------|---------|
| `pages/` | å­˜æ”¾æ‰€æœ‰ HTML é¡µé¢ | æŒ‰è§’è‰²åˆ†ç›®å½•ï¼ˆadminã€userï¼‰ï¼Œæ¯ä¸ªåŠŸèƒ½ä¸€ä¸ªé¡µé¢ |
| `js/config.js` | å…¨å±€é…ç½® | é›†ä¸­ç®¡ç† API åœ°å€ã€å¸¸é‡ï¼Œä¾¿äºç¯å¢ƒåˆ‡æ¢ |
| `js/utils/` | å·¥å…·å‡½æ•° | å°è£…é€šç”¨åŠŸèƒ½ï¼ˆHTTP è¯·æ±‚ã€å­˜å‚¨ï¼‰ï¼Œå¯åœ¨å¤šä¸ªé¡µé¢å¤ç”¨ |
| `js/api/` | æ¥å£è°ƒç”¨ | æŒ‰ä¸šåŠ¡æ¨¡å—æ‹†åˆ†ï¼ˆauthã€bookã€borrowï¼‰ï¼Œæ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ä¸€ç±»æ¥å£ |
| `js/modules/` | ä¸šåŠ¡é€»è¾‘ | æ¯ä¸ªé¡µé¢å¯¹åº”ä¸€ä¸ª JS æ–‡ä»¶ï¼Œé¿å…é€»è¾‘æ··æ‚ |

**ä¸ºä»€ä¹ˆè¦è¿™æ ·åˆ†å±‚ï¼Ÿ**

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ä¸€ä»¶äº‹ï¼Œä¿®æ”¹æŸä¸ªåŠŸèƒ½æ—¶åªéœ€å®šä½åˆ°å¯¹åº”æ–‡ä»¶
- **é¿å…å†—ä½™**ï¼šå·¥å…·å‡½æ•°å’Œ API è°ƒç”¨å¯ä»¥åœ¨å¤šä¸ªé¡µé¢ä¸­å¤ç”¨
- **ä¾¿äºåä½œ**ï¼šå‰ç«¯å›¢é˜Ÿå¯ä»¥å¹¶è¡Œå¼€å‘ä¸åŒçš„é¡µé¢ï¼Œäº’ä¸å¹²æ‰°
- **æ˜“äºæµ‹è¯•**ï¼šå¯ä»¥å•ç‹¬æµ‹è¯•æŸä¸ªæ¨¡å—çš„åŠŸèƒ½ï¼Œæ— éœ€å¯åŠ¨æ•´ä¸ªé¡¹ç›®

---

### 7.3 é…ç½®å±‚å¼€å‘

#### **æ­¥éª¤ 7.3.1**ï¼šåˆ›å»ºå…¨å±€é…ç½®æ–‡ä»¶

åœ¨ `library-frontend/js/config.js` ä¸­å®šä¹‰å…¨å±€é…ç½®ï¼š

```javascript
/**
 * å…¨å±€é…ç½®æ–‡ä»¶
 * é›†ä¸­ç®¡ç† API åœ°å€ã€Token é”®åç­‰å¸¸é‡
 */
const CONFIG = {
    // API åŸºç¡€åœ°å€ï¼ˆå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒå¯é€šè¿‡æ­¤å¤„åˆ‡æ¢ï¼‰
    API_BASE_URL: 'http://localhost:8080',

    // æœ¬åœ°å­˜å‚¨é”®åï¼ˆç»Ÿä¸€ç®¡ç†ï¼Œé¿å…é”®åå†²çªï¼‰
    STORAGE_KEYS: {
        TOKEN: 'library_token',
        USER_ROLE: 'library_role',
        USERNAME: 'library_username'
    },

    // è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    REQUEST_TIMEOUT: 10000,

    // é¡µé¢è·¯å¾„é…ç½®ï¼ˆä¾¿äºç»Ÿä¸€ç®¡ç†è·³è½¬è·¯å¾„ï¼‰
    PAGES: {
        LOGIN: '/pages/login.html',
        ADMIN_BOOKS: '/pages/admin/books.html',
        ADMIN_RECORDS: '/pages/admin/records.html',
        USER_BOOKS: '/pages/user/books.html',
        USER_RECORDS: '/pages/user/records.html'
    }
};

// å†»ç»“é…ç½®å¯¹è±¡ï¼Œé˜²æ­¢è¢«æ„å¤–ä¿®æ”¹
Object.freeze(CONFIG);
```

**ä¸ºä»€ä¹ˆéœ€è¦é…ç½®æ–‡ä»¶ï¼Ÿ**
- **ç¯å¢ƒåˆ‡æ¢**ï¼šå¼€å‘æ—¶ä½¿ç”¨ `localhost:8080`ï¼Œç”Ÿäº§ç¯å¢ƒåªéœ€ä¿®æ”¹ `API_BASE_URL` ä¸º `https://api.example.com`
- **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰å¸¸é‡é›†ä¸­å®šä¹‰ï¼Œé¿å…åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ï¼ˆå¦‚æœé”®åå†™é”™ï¼Œåªéœ€æ”¹ä¸€å¤„ï¼‰
- **é˜²æ­¢ç¯¡æ”¹**ï¼šä½¿ç”¨ `Object.freeze()` ç¡®ä¿é…ç½®ä¸è¢«æ„å¤–ä¿®æ”¹

---

### 7.4 å·¥å…·å±‚å¼€å‘

#### **æ­¥éª¤ 7.4.1**ï¼šå°è£…æœ¬åœ°å­˜å‚¨å·¥å…·

åœ¨ `library-frontend/js/utils/storage.js` ä¸­åˆ›å»ºï¼š

```javascript
/**
 * æœ¬åœ°å­˜å‚¨å·¥å…·ç±»
 * å°è£… localStorage æ“ä½œï¼Œç»Ÿä¸€ç®¡ç† Token å’Œç”¨æˆ·ä¿¡æ¯
 */
const StorageUtil = {
    /**
     * ä¿å­˜ Token
     */
    setToken(token) {
        localStorage.setItem(CONFIG.STORAGE_KEYS.TOKEN, token);
    },

    /**
     * è·å– Token
     */
    getToken() {
        return localStorage.getItem(CONFIG.STORAGE_KEYS.TOKEN);
    },

    /**
     * ä¿å­˜ç”¨æˆ·è§’è‰²
     */
    setRole(role) {
        localStorage.setItem(CONFIG.STORAGE_KEYS.USER_ROLE, role);
    },

    /**
     * è·å–ç”¨æˆ·è§’è‰²
     */
    getRole() {
        return localStorage.getItem(CONFIG.STORAGE_KEYS.USER_ROLE);
    },

    /**
     * ä¿å­˜ç”¨æˆ·å
     */
    setUsername(username) {
        localStorage.setItem(CONFIG.STORAGE_KEYS.USERNAME, username);
    },

    /**
     * è·å–ç”¨æˆ·å
     */
    getUsername() {
        return localStorage.getItem(CONFIG.STORAGE_KEYS.USERNAME);
    },

    /**
     * æ¸…ç©ºæ‰€æœ‰å­˜å‚¨ï¼ˆé€€å‡ºç™»å½•æ—¶è°ƒç”¨ï¼‰
     */
    clear() {
        localStorage.removeItem(CONFIG.STORAGE_KEYS.TOKEN);
        localStorage.removeItem(CONFIG.STORAGE_KEYS.USER_ROLE);
        localStorage.removeItem(CONFIG.STORAGE_KEYS.USERNAME);
    },

    /**
     * æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
     */
    isLoggedIn() {
        return !!this.getToken();
    }
};
```

**ä¸ºä»€ä¹ˆè¦å°è£… localStorageï¼Ÿ**
- **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰å­˜å‚¨æ“ä½œé€šè¿‡å·¥å…·ç±»è¿›è¡Œï¼Œé¿å…é”®åå†™é”™
- **æ˜“äºç»´æŠ¤**ï¼šå¦‚æœå°†æ¥æ”¹ç”¨ `sessionStorage` æˆ– `IndexedDB`ï¼Œåªéœ€ä¿®æ”¹æ­¤æ–‡ä»¶
- **ç±»å‹å®‰å…¨**ï¼šå¯ä»¥åœ¨å·¥å…·ç±»ä¸­æ·»åŠ æ•°æ®éªŒè¯é€»è¾‘ï¼ˆå¦‚æ£€æŸ¥ Token æ ¼å¼ï¼‰

---
#### **æ­¥éª¤ 7.4.2**ï¼šå°è£… HTTP è¯·æ±‚å·¥å…·

åœ¨ `library-frontend/js/utils/http.js` ä¸­åˆ›å»ºï¼š

```javascript
/**
 * HTTP è¯·æ±‚å·¥å…·ç±»
 * åŸºäº Axios å°è£…ï¼Œç»Ÿä¸€å¤„ç† Tokenã€é”™è¯¯ã€åŠ è½½çŠ¶æ€
 */

// åˆ›å»º Axios å®ä¾‹
const httpInstance = axios.create({
    baseURL: CONFIG.API_BASE_URL,  // API åŸºç¡€åœ°å€
    timeout: CONFIG.REQUEST_TIMEOUT  // è¯·æ±‚è¶…æ—¶æ—¶é—´
});

// ========== è¯·æ±‚æ‹¦æˆªå™¨ ==========
httpInstance.interceptors.request.use(
    (config) => {
        // 1. æ˜¾ç¤ºåŠ è½½è¿›åº¦æ¡
        NProgress.start();

        // 2. è‡ªåŠ¨æ·»åŠ  Token
        const token = StorageUtil.getToken();
        if (token) {
            config.headers['Authorization'] = `Bearer ${token}`;
        }

        return config;
    },
    (error) => {
        // è¯·æ±‚é”™è¯¯å¤„ç†
        NProgress.done();
        return Promise.reject(error);
    }
);

// ========== å“åº”æ‹¦æˆªå™¨ ==========
httpInstance.interceptors.response.use(
    (response) => {
        // 1. å…³é—­åŠ è½½è¿›åº¦æ¡
        NProgress.done();

        // 2. è¿”å›å“åº”æ•°æ®
        return response.data;
    },
    (error) => {
        // 1. å…³é—­åŠ è½½è¿›åº¦æ¡
        NProgress.done();

        // 2. å¤„ç† HTTP çŠ¶æ€ç é”™è¯¯
        if (error.response) {
            const status = error.response.status;

            if (status === 401) {
                // Token è¿‡æœŸæˆ–æœªç™»å½•
                Swal.fire({
                    icon: 'warning',
                    title: 'ç™»å½•å·²è¿‡æœŸ',
                    text: 'è¯·é‡æ–°ç™»å½•',
                    confirmButtonColor: '#000'
                }).then(() => {
                    StorageUtil.clear();
                    window.location.href = CONFIG.PAGES.LOGIN;
                });
            } else if (status === 403) {
                // æƒé™ä¸è¶³
                Swal.fire({
                    icon: 'error',
                    title: 'æƒé™ä¸è¶³',
                    text: 'æ‚¨æ²¡æœ‰è®¿é—®æ­¤èµ„æºçš„æƒé™',
                    confirmButtonColor: '#000'
                });
            } else if (status === 500) {
                // æœåŠ¡å™¨é”™è¯¯
                Swal.fire({
                    icon: 'error',
                    title: 'æœåŠ¡å™¨é”™è¯¯',
                    text: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•',
                    confirmButtonColor: '#000'
                });
            } else {
                // å…¶ä»–é”™è¯¯
                Swal.fire({
                    icon: 'error',
                    title: 'è¯·æ±‚å¤±è´¥',
                    text: error.response.data.message || 'è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•',
                    confirmButtonColor: '#000'
                });
            }
        } else if (error.request) {
            // è¯·æ±‚å·²å‘é€ä½†æœªæ”¶åˆ°å“åº”ï¼ˆç½‘ç»œé”™è¯¯ï¼‰
            Swal.fire({
                icon: 'error',
                title: 'ç½‘ç»œé”™è¯¯',
                text: 'ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•',
                confirmButtonColor: '#000'
            });
        } else {
            // å…¶ä»–é”™è¯¯
            Swal.fire({
                icon: 'error',
                title: 'è¯·æ±‚å¤±è´¥',
                text: error.message || 'æœªçŸ¥é”™è¯¯',
                confirmButtonColor: '#000'
            });
        }

        return Promise.reject(error);
    }
);

// ========== å°è£…è¯·æ±‚æ–¹æ³• ==========
const HttpUtil = {
    /**
     * å‘é€ GET è¯·æ±‚
     * @param {string} url - æ¥å£è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„ï¼Œå¦‚ '/api/books'ï¼‰
     * @param {object} params - æŸ¥è¯¢å‚æ•°ï¼ˆå¯é€‰ï¼‰
     * @param {object} config - Axios é…ç½®ï¼ˆå¯é€‰ï¼‰
     */
    get(url, params = {}, config = {}) {
        return httpInstance.get(url, {
            params,
            ...config
        });
    },

    /**
     * å‘é€ POST è¯·æ±‚
     * @param {string} url - æ¥å£è·¯å¾„
     * @param {object} data - è¯·æ±‚ä½“æ•°æ®
     * @param {object} config - Axios é…ç½®ï¼ˆå¯é€‰ï¼‰
     */
    post(url, data = {}, config = {}) {
        return httpInstance.post(url, data, config);
    },

    /**
     * å‘é€ PUT è¯·æ±‚
     * @param {string} url - æ¥å£è·¯å¾„
     * @param {object} data - è¯·æ±‚ä½“æ•°æ®
     * @param {object} config - Axios é…ç½®ï¼ˆå¯é€‰ï¼‰
     */
    put(url, data = {}, config = {}) {
        return httpInstance.put(url, data, config);
    },

    /**
     * å‘é€ DELETE è¯·æ±‚
     * @param {string} url - æ¥å£è·¯å¾„
     * @param {object} config - Axios é…ç½®ï¼ˆå¯é€‰ï¼‰
     */
    delete(url, config = {}) {
        return httpInstance.delete(url, config);
    }
};
```

---

#### **æ­¥éª¤ 7.4.3**ï¼šåœ¨ HTML ä¸­å¼•å…¥ Axiosï¼ˆæé†’å°èŠ‚ï¼‰

è¿™ä¸ªæ­¥éª¤ä½œä¸ºæé†’ï¼Œaxioså¿…é¡»åœ¨æ‰€æœ‰ä¾èµ–ä¹‹å‰å¼•å…¥

åœ¨æ‰€æœ‰ HTML æ–‡ä»¶çš„ `<head>` æ ‡ç­¾ä¸­ï¼Œ**åœ¨å¼•å…¥å…¶ä»– JS æ–‡ä»¶ä¹‹å‰**ï¼Œå…ˆå¼•å…¥ Axios CDNï¼š

```html
<!-- å¼•å…¥ Axiosï¼ˆå¿…é¡»åœ¨å…¶ä»– JS æ–‡ä»¶ä¹‹å‰ï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>

<!-- ç„¶åå†å¼•å…¥é…ç½®å’Œå·¥å…·ç±» -->
<script src="../js/config.js"></script>
<script src="../js/utils/storage.js"></script>
<script src="../js/utils/http.js"></script>
```

**æ³¨æ„äº‹é¡¹**ï¼š
- Axios å¿…é¡»åœ¨ `http.js` ä¹‹å‰å¼•å…¥ï¼Œå¦åˆ™ä¼šæŠ¥é”™ `axios is not defined`
- ä½¿ç”¨ CDN ç‰ˆæœ¬å¯ä»¥å‡å°‘é¡¹ç›®ä½“ç§¯ï¼Œæ— éœ€æœ¬åœ°å®‰è£…ä¾èµ–
---

### 7.5 API å±‚å¼€å‘

#### **æ­¥éª¤ 7.5.1**ï¼šå°è£…è®¤è¯æ¥å£

åœ¨ `library-frontend/js/api/auth.js` ä¸­åˆ›å»ºï¼š

```javascript
/**
 * è®¤è¯ç›¸å…³æ¥å£
 * å¤„ç†ç™»å½•ã€ç™»å‡ºç­‰æ“ä½œ
 */
const AuthAPI = {
    /**
     * ç”¨æˆ·ç™»å½•
     * @param {string} username - ç”¨æˆ·å
     * @param {string} password - å¯†ç 
     * @returns {Promise<object>} è¿”å› Token å’Œç”¨æˆ·ä¿¡æ¯
     */
    async login(username, password) {
        const result = await HttpUtil.post('/api/login', {
            username,
            password
        });

        // å¦‚æœç™»å½•æˆåŠŸï¼Œä¿å­˜ Token å’Œç”¨æˆ·ä¿¡æ¯
        if (result.code === 200) {
            StorageUtil.setToken(result.data.token);
            StorageUtil.setRole(result.data.role);
            StorageUtil.setUsername(result.data.username);
        }

        return result;
    },

    /**
     * é€€å‡ºç™»å½•
     */
    logout() {
        StorageUtil.clear();
        window.location.href = CONFIG.PAGES.LOGIN;
    }
};
```

---

#### **æ­¥éª¤ 7.5.2**ï¼šå°è£…å›¾ä¹¦ç®¡ç†æ¥å£

åœ¨ `library-frontend/js/api/book.js` ä¸­åˆ›å»ºï¼š

```javascript
/**
 * å›¾ä¹¦ç®¡ç†æ¥å£
 * æä¾›å›¾ä¹¦çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½
 */
const BookAPI = {
    /**
     * æŸ¥è¯¢æ‰€æœ‰å›¾ä¹¦
     * @returns {Promise<Array>} å›¾ä¹¦åˆ—è¡¨
     */
    async getAllBooks() {
        const result = await HttpUtil.get('/api/books');
        return result.code === 200 ? result.data : [];
    },

    /**
     * æ–°å¢å›¾ä¹¦
     * @param {object} book - å›¾ä¹¦ä¿¡æ¯
     */
    async addBook(book) {
        return await HttpUtil.post('/api/books', book);
    },

    /**
     * æ›´æ–°å›¾ä¹¦
     * @param {object} book - å›¾ä¹¦ä¿¡æ¯ï¼ˆå¿…é¡»åŒ…å« idï¼‰
     */
    async updateBook(book) {
        return await HttpUtil.put('/api/books', book);
    },

    /**
     * åˆ é™¤å›¾ä¹¦
     * @param {number} id - å›¾ä¹¦ ID
     */
    async deleteBook(id) {
        return await HttpUtil.delete(`/api/books/${id}`);
    }
};
```

---

#### **æ­¥éª¤ 7.5.3**ï¼šå°è£…å€Ÿé˜…ç®¡ç†æ¥å£

åœ¨ `library-frontend/js/api/borrow.js` ä¸­åˆ›å»ºï¼š

```javascript
/**
 * å€Ÿé˜…ç®¡ç†æ¥å£
 * å¤„ç†å€Ÿä¹¦ã€è¿˜ä¹¦ã€æŸ¥è¯¢è®°å½•ç­‰æ“ä½œ
 */
const BorrowAPI = {
    /**
     * å€Ÿä¹¦
     * @param {number} bookId - å›¾ä¹¦ ID
     */
    async borrowBook(bookId) {
        return await HttpUtil.post(`/api/borrow/${bookId}`);
    },

    /**
     * æŸ¥è¯¢æˆ‘çš„å€Ÿé˜…è®°å½•
     * @returns {Promise<Array>} å€Ÿé˜…è®°å½•åˆ—è¡¨
     */
    async getMyRecords() {
        const result = await HttpUtil.get('/api/borrow/my');
        return result.code === 200 ? result.data : [];
    },

    /**
     * è¿˜ä¹¦
     * @param {number} recordId - å€Ÿé˜…è®°å½• ID
     */
    async returnBook(recordId) {
        return await HttpUtil.post(`/api/borrow/return/${recordId}`);
    },

    /**
     * æŸ¥è¯¢æ‰€æœ‰å€Ÿé˜…è®°å½•ï¼ˆç®¡ç†å‘˜ï¼‰
     * @returns {Promise<Array>} æ‰€æœ‰å€Ÿé˜…è®°å½•
     */
    async getAllRecords() {
        const result = await HttpUtil.get('/api/borrow/all');
        return result.code === 200 ? result.data : [];
    }
};
```

**ä¸ºä»€ä¹ˆè¦æŒ‰ä¸šåŠ¡æ¨¡å—æ‹†åˆ† APIï¼Ÿ**
- **èŒè´£æ¸…æ™°**ï¼šæ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ä¸€ä¸ªä¸šåŠ¡æ¨¡å—ï¼Œæ˜“äºæŸ¥æ‰¾å’Œç»´æŠ¤
- **é¿å…å†—ä½™**ï¼šå¦‚æœå¤šä¸ªé¡µé¢éœ€è¦è°ƒç”¨åŒä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥ç›´æ¥å¤ç”¨
- **ä¾¿äºæµ‹è¯•**ï¼šå¯ä»¥å•ç‹¬æµ‹è¯•æŸä¸ªæ¨¡å—çš„æ¥å£æ˜¯å¦æ­£å¸¸

---

### 7.6 ä¸šåŠ¡é€»è¾‘å±‚å¼€å‘

#### **æ­¥éª¤ 7.6.1**ï¼šç™»å½•é¡µé¢é€»è¾‘

åœ¨ `library-frontend/js/modules/login.js` ä¸­åˆ›å»ºï¼š

```javascript
/**
 * ç™»å½•é¡µé¢ä¸šåŠ¡é€»è¾‘
 */
function loginModule() {
    return {
        // è¡¨å•æ•°æ®
        loginForm: {
            username: '',
            password: ''
        },
        loading: false,

        /**
         * é¡µé¢åˆå§‹åŒ–
         * æ£€æŸ¥æ˜¯å¦å·²ç™»å½•ï¼Œå¦‚æœå·²ç™»å½•åˆ™è·³è½¬åˆ°å¯¹åº”é¡µé¢
         */
        init() {
            if (StorageUtil.isLoggedIn()) {
                const role = StorageUtil.getRole();
                if (role === 'ADMIN') {
                    window.location.href = CONFIG.PAGES.ADMIN_BOOKS;
                } else {
                    window.location.href = CONFIG.PAGES.USER_BOOKS;
                }
            }
        },

        /**
         * å¤„ç†ç™»å½•
         */
        async handleLogin() {
            // 1. è¡¨å•éªŒè¯
            if (!this.loginForm.username || !this.loginForm.password) {
                Swal.fire({
                    icon: 'warning',
                    title: 'è¯·å¡«å†™å®Œæ•´ä¿¡æ¯',
                    confirmButtonColor: '#000'
                });
                return;
            }

            // 2. æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            this.loading = true;

            try {
                // 3. è°ƒç”¨ç™»å½•æ¥å£
                const result = await AuthAPI.login(
                    this.loginForm.username,
                    this.loginForm.password
                );

                // 4. å¤„ç†ç™»å½•ç»“æœ
                if (result.code === 200) {
                    // ç™»å½•æˆåŠŸï¼Œæ˜¾ç¤ºæç¤º
                    const Toast = Swal.mixin({
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 2000
                    });
                    Toast.fire({
                        icon: 'success',
                        title: 'ç™»å½•æˆåŠŸ'
                    });

                    // æ ¹æ®è§’è‰²è·³è½¬åˆ°å¯¹åº”é¡µé¢
                    setTimeout(() => {
                        if (result.data.role === 'ADMIN') {
                            window.location.href = CONFIG.PAGES.ADMIN_BOOKS;
                        } else {
                            window.location.href = CONFIG.PAGES.USER_BOOKS;
                        }
                    }, 1000);
                } else {
                    // ç™»å½•å¤±è´¥
                    Swal.fire({
                        icon: 'error',
                        title: 'ç™»å½•å¤±è´¥',
                        text: result.message,
                        confirmButtonColor: '#000'
                    });
                }
            } catch (error) {
                console.error('ç™»å½•å¤±è´¥:', error);
            } finally {
                this.loading = false;
            }
        }
    }
}
```

---

#### **æ­¥éª¤ 7.6.2**ï¼šç®¡ç†å‘˜-å›¾ä¹¦ç®¡ç†é¡µé¢é€»è¾‘

åœ¨ `library-frontend/js/modules/admin-books.js` ä¸­åˆ›å»ºï¼š

```javascript
/**
 * ç®¡ç†å‘˜-å›¾ä¹¦ç®¡ç†é¡µé¢ä¸šåŠ¡é€»è¾‘
 */
function adminBooksModule() {
    return {
        // æ•°æ®
        books: [],
        userInfo: {},

        // è¡¨å•æ•°æ®
        bookForm: {
            id: null,
            title: '',
            author: '',
            publisher: '',
            totalQuantity: 10
        },
        showBookModal: false,
        isEdit: false,

        /**
         * é¡µé¢åˆå§‹åŒ–
         */
        async init() {
            // 1. æƒé™æ£€æŸ¥
            if (!StorageUtil.isLoggedIn()) {
                window.location.href = CONFIG.PAGES.LOGIN;
                return;
            }

            if (StorageUtil.getRole() !== 'ADMIN') {
                Swal.fire({
                    icon: 'error',
                    title: 'æƒé™ä¸è¶³',
                    text: 'æ‚¨æ²¡æœ‰è®¿é—®æ­¤é¡µé¢çš„æƒé™',
                    confirmButtonColor: '#000'
                }).then(() => {
                    window.location.href = CONFIG.PAGES.LOGIN;
                });
                return;
            }

            // 2. åŠ è½½ç”¨æˆ·ä¿¡æ¯
            this.userInfo = {
                username: StorageUtil.getUsername(),
                role: StorageUtil.getRole()
            };

            // 3. åŠ è½½å›¾ä¹¦åˆ—è¡¨
            await this.loadBooks();
        },

        /**
         * åŠ è½½å›¾ä¹¦åˆ—è¡¨
         */
        async loadBooks() {
            this.books = await BookAPI.getAllBooks();
        },

        /**
         * æ‰“å¼€å›¾ä¹¦ç¼–è¾‘å¼¹çª—
         * @param {object|null} book - å¦‚æœä¸º null åˆ™ä¸ºæ–°å¢æ¨¡å¼
         */
        openBookModal(book = null) {
            this.isEdit = !!book;
            if (book) {
                // ç¼–è¾‘æ¨¡å¼ï¼šå¤åˆ¶å›¾ä¹¦æ•°æ®åˆ°è¡¨å•
                this.bookForm = JSON.parse(JSON.stringify(book));
            } else {
                // æ–°å¢æ¨¡å¼ï¼šé‡ç½®è¡¨å•
                this.bookForm = {
                    id: null,
                    title: '',
                    author: '',
                    publisher: '',
                    totalQuantity: 10
                };
            }
            this.showBookModal = true;
        },

        /**
         * æäº¤å›¾ä¹¦è¡¨å•ï¼ˆæ–°å¢æˆ–ç¼–è¾‘ï¼‰
         */
        async submitBook() {
            // 1. è¡¨å•éªŒè¯
            if (!this.bookForm.title || !this.bookForm.totalQuantity) {
                Swal.fire({
                    icon: 'warning',
                    title: 'è¯·å¡«å†™å®Œæ•´ä¿¡æ¯',
                    confirmButtonColor: '#000'
                });
                return;
            }

            try {
                let result;
                if (this.isEdit) {
                    // ç¼–è¾‘æ¨¡å¼
                    result = await BookAPI.updateBook(this.bookForm);
                } else {
                    // æ–°å¢æ¨¡å¼
                    result = await BookAPI.addBook(this.bookForm);
                }

                if (result.code === 200) {
                    this.showBookModal = false;
                    await this.loadBooks(); // åˆ·æ–°åˆ—è¡¨
                    Swal.fire({
                        icon: 'success',
                        title: 'æ“ä½œæˆåŠŸ',
                        showConfirmButton: false,
                        timer: 1500
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'æ“ä½œå¤±è´¥',
                        text: result.message,
                        confirmButtonColor: '#000'
                    });
                }
            } catch (error) {
                console.error('æäº¤å›¾ä¹¦å¤±è´¥:', error);
            }
        },

        /**
         * åˆ é™¤å›¾ä¹¦
         * @param {number} id - å›¾ä¹¦ ID
         */
        async deleteBook(id) {
            const result = await Swal.fire({
                title: 'ç¡®å®šåˆ é™¤?',
                text: "æ­¤æ“ä½œä¸å¯æ¢å¤",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#000',
                cancelButtonColor: '#d33',
                confirmButtonText: 'åˆ é™¤',
                cancelButtonText: 'å–æ¶ˆ'
            });

            if (result.isConfirmed) {
                try {
                    const apiResult = await BookAPI.deleteBook(id);
                    if (apiResult.code === 200) {
                        await this.loadBooks(); // åˆ·æ–°åˆ—è¡¨
                        Swal.fire({
                            icon: 'success',
                            title: 'å·²åˆ é™¤',
                            showConfirmButton: false,
                            timer: 1000
                        });
                    }
                } catch (error) {
                    console.error('åˆ é™¤å›¾ä¹¦å¤±è´¥:', error);
                }
            }
        },

        /**
         * é€€å‡ºç™»å½•
         */
        logout() {
            AuthAPI.logout();
        }
    }
}
```

---

#### **æ­¥éª¤ 7.6.3**ï¼šç®¡ç†å‘˜-å€Ÿé˜…æ€»è§ˆé¡µé¢é€»è¾‘

åœ¨ `library-frontend/js/modules/admin-records.js` ä¸­åˆ›å»ºï¼š

```javascript
/**
 * ç®¡ç†å‘˜-å€Ÿé˜…æ€»è§ˆé¡µé¢ä¸šåŠ¡é€»è¾‘
 */
function adminRecordsModule() {
    return {
        // æ•°æ®
        records: [],
        books: [], // ç”¨äºæ˜¾ç¤ºå›¾ä¹¦åç§°
        userInfo: {},

        /**
         * é¡µé¢åˆå§‹åŒ–
         */
        async init() {
            // 1. æƒé™æ£€æŸ¥
            if (!StorageUtil.isLoggedIn() || StorageUtil.getRole() !== 'ADMIN') {
                window.location.href = CONFIG.PAGES.LOGIN;
                return;
            }

            // 2. åŠ è½½ç”¨æˆ·ä¿¡æ¯
            this.userInfo = {
                username: StorageUtil.getUsername(),
                role: StorageUtil.getRole()
            };

            // 3. åŠ è½½æ•°æ®
            await this.loadRecords();
            await this.loadBooks();
        },

        /**
         * åŠ è½½å€Ÿé˜…è®°å½•
         */
        async loadRecords() {
            this.records = await BorrowAPI.getAllRecords();
        },

        /**
         * åŠ è½½å›¾ä¹¦åˆ—è¡¨ï¼ˆç”¨äºæ˜¾ç¤ºå›¾ä¹¦åç§°ï¼‰
         */
        async loadBooks() {
            this.books = await BookAPI.getAllBooks();
        },

        /**
         * æ ¹æ®å›¾ä¹¦ ID è·å–å›¾ä¹¦åç§°
         */
        getBookTitle(bookId) {
            const book = this.books.find(b => b.id === bookId);
            return book ? book.title : `å›¾ä¹¦ID: ${bookId}`;
        },

        /**
         * æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
         */
        formatDate(isoString) {
            if (!isoString) return '-';
            const d = new Date(isoString);
            return d.toLocaleDateString() + ' ' + d.toLocaleTimeString([], {
                hour: '2-digit',
                minute: '2-digit'
            });
        },

        /**
         * é€€å‡ºç™»å½•
         */
        logout() {
            AuthAPI.logout();
        }
    }
}
```

---

#### **æ­¥éª¤ 7.6.4**ï¼šç”¨æˆ·-å›¾ä¹¦å€Ÿé˜…é¡µé¢é€»è¾‘

åœ¨ `library-frontend/js/modules/user-books.js` ä¸­åˆ›å»ºï¼š

```javascript
/**
 * ç”¨æˆ·-å›¾ä¹¦å€Ÿé˜…é¡µé¢ä¸šåŠ¡é€»è¾‘
 */
function userBooksModule() {
    return {
        // æ•°æ®
        books: [],
        userInfo: {},

        /**
         * é¡µé¢åˆå§‹åŒ–
         */
        async init() {
            // 1. æƒé™æ£€æŸ¥
            if (!StorageUtil.isLoggedIn()) {
                window.location.href = CONFIG.PAGES.LOGIN;
                return;
            }

            if (StorageUtil.getRole() !== 'USER') {
                Swal.fire({
                    icon: 'error',
                    title: 'æƒé™ä¸è¶³',
                    confirmButtonColor: '#000'
                }).then(() => {
                    window.location.href = CONFIG.PAGES.LOGIN;
                });
                return;
            }

            // 2. åŠ è½½ç”¨æˆ·ä¿¡æ¯
            this.userInfo = {
                username: StorageUtil.getUsername(),
                role: StorageUtil.getRole()
            };

            // 3. åŠ è½½å›¾ä¹¦åˆ—è¡¨
            await this.loadBooks();
        },

        /**
         * åŠ è½½å›¾ä¹¦åˆ—è¡¨
         */
        async loadBooks() {
            this.books = await BookAPI.getAllBooks();
        },

        /**
         * å€Ÿä¹¦
         * @param {number} bookId - å›¾ä¹¦ ID
         */
        async borrowBook(bookId) {
            try {
                const result = await BorrowAPI.borrowBook(bookId);
                if (result.code === 200) {
                    await this.loadBooks(); // åˆ·æ–°å›¾ä¹¦åˆ—è¡¨ï¼ˆåº“å­˜å·²å˜åŒ–ï¼‰
                    Swal.fire({
                        icon: 'success',
                        title: 'å€Ÿé˜…æˆåŠŸ',
                        text: 'è¯·æŒ‰æ—¶å½’è¿˜',
                        confirmButtonColor: '#000'
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'å€Ÿé˜…å¤±è´¥',
                        text: result.message,
                        confirmButtonColor: '#000'
                    });
                }
            } catch (error) {
                console.error('å€Ÿä¹¦å¤±è´¥:', error);
            }
        },

        /**
         * é€€å‡ºç™»å½•
         */
        logout() {
            AuthAPI.logout();
        }
    }
}
```

---

#### **æ­¥éª¤ 7.6.5**ï¼šç”¨æˆ·-æˆ‘çš„å€Ÿé˜…è®°å½•é¡µé¢é€»è¾‘

åœ¨ `library-frontend/js/modules/user-records.js` ä¸­åˆ›å»ºï¼š

```javascript
/**
 * ç”¨æˆ·-æˆ‘çš„å€Ÿé˜…è®°å½•é¡µé¢ä¸šåŠ¡é€»è¾‘
 */
function userRecordsModule() {
    return {
        // æ•°æ®
        records: [],
        books: [], // ç”¨äºæ˜¾ç¤ºå›¾ä¹¦åç§°
        userInfo: {},

        /**
         * é¡µé¢åˆå§‹åŒ–
         */
        async init() {
            // 1. æƒé™æ£€æŸ¥
            if (!StorageUtil.isLoggedIn() || StorageUtil.getRole() !== 'USER') {
                window.location.href = CONFIG.PAGES.LOGIN;
                return;
            }

            // 2. åŠ è½½ç”¨æˆ·ä¿¡æ¯
            this.userInfo = {
                username: StorageUtil.getUsername(),
                role: StorageUtil.getRole()
            };

            // 3. åŠ è½½æ•°æ®
            await this.loadRecords();
            await this.loadBooks();
        },

        /**
         * åŠ è½½æˆ‘çš„å€Ÿé˜…è®°å½•
         */
        async loadRecords() {
            this.records = await BorrowAPI.getMyRecords();
        },

        /**
         * åŠ è½½å›¾ä¹¦åˆ—è¡¨ï¼ˆç”¨äºæ˜¾ç¤ºå›¾ä¹¦åç§°ï¼‰
         */
        async loadBooks() {
            this.books = await BookAPI.getAllBooks();
        },

        /**
         * è¿˜ä¹¦
         * @param {number} recordId - å€Ÿé˜…è®°å½• ID
         */
        async returnBook(recordId) {
            const result = await Swal.fire({
                title: 'å½’è¿˜å›¾ä¹¦?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#000',
                confirmButtonText: 'ç¡®è®¤å½’è¿˜',
                cancelButtonText: 'å–æ¶ˆ'
            });

            if (result.isConfirmed) {
                try {
                    const apiResult = await BorrowAPI.returnBook(recordId);
                    if (apiResult.code === 200) {
                        await this.loadRecords(); // åˆ·æ–°å€Ÿé˜…è®°å½•
                        await this.loadBooks(); // åˆ·æ–°å›¾ä¹¦åˆ—è¡¨ï¼ˆåº“å­˜å·²æ¢å¤ï¼‰
                        Swal.fire({
                            icon: 'success',
                            title: 'å½’è¿˜æˆåŠŸ',
                            showConfirmButton: false,
                            timer: 1000
                        });
                    }
                } catch (error) {
                    console.error('è¿˜ä¹¦å¤±è´¥:', error);
                }
            }
        },

        /**
         * æ ¹æ®å›¾ä¹¦ ID è·å–å›¾ä¹¦åç§°
         */
        getBookTitle(bookId) {
            const book = this.books.find(b => b.id === bookId);
            return book ? book.title : `å›¾ä¹¦ID: ${bookId}`;
        },

        /**
         * æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
         */
        formatDate(isoString) {
            if (!isoString) return '-';
            const d = new Date(isoString);
            return d.toLocaleDateString() + ' ' + d.toLocaleTimeString([], {
                hour: '2-digit',
                minute: '2-digit'
            });
        },

        /**
         * é€€å‡ºç™»å½•
         */
        logout() {
            AuthAPI.logout();
        }
    }
}
```

---

### 7.7 é¡µé¢å¼€å‘

#### **æ­¥éª¤ 7.7.1**ï¼šåˆ›å»ºå…¥å£é¡µé¢

åœ¨ `library-frontend/index.html` ä¸­åˆ›å»ºï¼š

```html
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Javaå®è®­-å½­æ¶¦æ¶¦-å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/utils/storage.js"></script>
    <script>
        // è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µæˆ–ç³»ç»Ÿé¡µ
        if (StorageUtil.isLoggedIn()) {
            const role = StorageUtil.getRole();
            if (role === 'ADMIN') {
                window.location.href = CONFIG.PAGES.ADMIN_BOOKS;
            } else {
                window.location.href = CONFIG.PAGES.USER_BOOKS;
            }
        } else {
            window.location.href = CONFIG.PAGES.LOGIN;
        }
    </script>
</head>

<body>
    <div style="text-align: center; padding: 50px;">
        <p>æ­£åœ¨è·³è½¬...</p>
    </div>
</body>

</html>
```

---

#### **æ­¥éª¤ 7.7.2**ï¼šåˆ›å»ºç™»å½•é¡µé¢

åœ¨ `library-frontend/pages/login.html` ä¸­åˆ›å»ºï¼š

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - æ™ºå›¾Â·äº‘å€Ÿé˜…</title>

    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. RemixIcon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <!-- 3. Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <!-- 4. NProgress -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css">
    <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>

    <!-- 5. SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- 6. Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js" defer></script>

    <!-- 7. å¼•å…¥é…ç½®å’Œå·¥å…·ç±» -->
    <script src="../js/config.js"></script>
    <script src="../js/utils/storage.js"></script>
    <script src="../js/utils/http.js"></script>
    <script src="../js/api/auth.js"></script>
    <script src="../js/modules/login.js"></script>

    <style>
        :root {
            --bg-main: #ffffff;
            --bg-secondary: #f9fafb;
            --text-main: #111827;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --accent-color: #000000;
            --accent-hover: #333333;
            --accent-text: #ffffff;
        }

        body {
            background-color: var(--bg-secondary);
            color: var(--text-main);
        }

        #nprogress .bar { background: var(--accent-color) !important; height: 3px !important; }

        .btn-primary {
            background-color: var(--accent-color);
            color: var(--accent-text);
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: var(--accent-hover);
            transform: translateY(-1px);
        }

        [x-cloak] { display: none !important; }
    </style>
</head>

<body class="font-sans antialiased selection:bg-black selection:text-white"
      x-data="loginModule()" x-init="init()" x-cloak>

    <div class="min-h-screen flex items-center justify-center bg-white relative overflow-hidden">

        <div class="absolute top-0 right-0 w-1/3 h-full bg-gray-50 transform skew-x-12 translate-x-20 z-0"></div>

        <div class="w-full max-w-md p-8 z-10">
            <div class="mb-12">
                <div class="w-12 h-12 bg-black text-white flex items-center justify-center rounded-lg mb-4 text-2xl">
                    <i class="ri-book-mark-fill"></i>
                </div>
                <h1 class="text-4xl font-bold tracking-tight mb-2">æ¬¢è¿å›æ¥</h1>
                <p class="text-gray-600">è¯·è¾“å…¥æ‚¨çš„è´¦å·å¯†ç è®¿é—®å›¾ä¹¦é¦†ç³»ç»Ÿ</p>
            </div>

            <form @submit.prevent="handleLogin" class="space-y-6">
                <div>
                    <label class="block text-sm font-semibold mb-2">è´¦å·</label>
                    <input type="text" x-model="loginForm.username"
                           class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:bg-white transition-all"
                           placeholder="admin æˆ– user1">
                </div>

                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-semibold">å¯†ç </label>
                        <a href="#" class="text-xs text-gray-600 hover:text-black underline">å¿˜è®°å¯†ç ?</a>
                    </div>
                    <input type="password" x-model="loginForm.password"
                           class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:bg-white transition-all"
                           placeholder="admin123 æˆ– user123">
                </div>

                <button type="submit"
                        class="w-full btn-primary py-3.5 rounded-lg font-bold text-lg shadow-lg flex justify-center items-center">
                    <span x-show="!loading">ç™» å½•</span>
                    <i x-show="loading" class="ri-loader-4-line animate-spin text-xl"></i>
                </button>
            </form>

            <div class="mt-8 text-center text-xs text-gray-600">
                &copy; 2025 Library System. Minimalism Design.
            </div>
        </div>
    </div>

</body>
</html>
```

---

#### **æ­¥éª¤ 7.7.3**ï¼šåˆ›å»ºç®¡ç†å‘˜-å›¾ä¹¦ç®¡ç†é¡µé¢

åœ¨ `library-frontend/pages/admin/books.html` ä¸­åˆ›å»ºï¼š

```html
</html>
```

---

#### **æ­¥éª¤ 7.7.4**ï¼šåˆ›å»ºç®¡ç†å‘˜-å€Ÿé˜…æ€»è§ˆé¡µé¢

åœ¨ `library-frontend/pages/admin/records.html` ä¸­åˆ›å»ºï¼š

```html
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€Ÿé˜…æ€»è§ˆ - æ™ºå›¾Â·äº‘å€Ÿé˜…</title>

    <!-- CDN å¼•å…¥ï¼ˆåŒä¸Šï¼‰ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css">
    <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>
    <!-- å¼•å…¥é…ç½®å’Œå·¥å…·ç±» -->
    <script src="../../js/config.js"></script>
    <script src="../../js/utils/storage.js"></script>
    <script src="../../js/utils/http.js"></script>
    <script src="../../js/api/auth.js"></script>
    <script src="../../js/api/book.js"></script>
    <script src="../../js/api/borrow.js"></script>
    <script src="../../js/modules/admin-records.js"></script>

    <style>
        :root {
            --bg-main: #ffffff;
            --bg-secondary: #f9fafb;
            --text-main: #111827;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --accent-color: #000000;
            --accent-hover: #333333;
            --accent-text: #ffffff;
        }

        body {
            background-color: var(--bg-secondary);
            color: var(--text-main);
        }

        #nprogress .bar {
            background: var(--accent-color) !important;
            height: 3px !important;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: var(--accent-text);
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background-color: var(--accent-hover);
            transform: translateY(-1px);
        }

        [x-cloak] {
            display: none !important;
        }
    </style>
</head>

<body class="font-sans antialiased selection:bg-black selection:text-white" x-data="adminRecordsModule()"
    x-init="init()" x-cloak>

    <div class="min-h-screen flex">

        <!-- ä¾§è¾¹æ  -->
        <aside class="w-64 bg-black text-white flex flex-col fixed inset-y-0 z-20">
            <div class="h-20 flex items-center px-8 border-b border-gray-800">
                <i class="ri-book-mark-fill text-2xl mr-3"></i>
                <span class="text-xl font-bold tracking-wider">æ™ºå›¾ç³»ç»Ÿ</span>
            </div>

            <nav class="flex-1 px-4 py-8 space-y-2">
                <p class="px-4 text-xs text-gray-500 font-bold mb-2 uppercase tracking-widest">ç®¡ç†</p>
                <a href="books.html"
                    class="flex items-center px-4 py-3 rounded-lg text-gray-400 hover:text-white transition-all duration-300">
                    <i class="ri-book-2-line mr-3"></i> å›¾ä¹¦ç®¡ç†
                </a>
                <a href="records.html" class="flex items-center px-4 py-3 rounded-lg bg-white text-black">
                    <i class="ri-file-list-3-line mr-3"></i> å€Ÿé˜…æ€»è§ˆ
                </a>
            </nav>

            <div class="p-6 border-t border-gray-800">
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 rounded bg-gray-700 flex items-center justify-center text-sm font-bold">
                        <span x-text="userInfo.username ? userInfo.username.charAt(0).toUpperCase() : 'A'"></span>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-bold text-white" x-text="userInfo.username"></p>
                        <p class="text-xs text-gray-500" x-text="userInfo.role"></p>
                    </div>
                </div>
                <button @click="logout"
                    class="w-full py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-white rounded text-sm transition-colors">
                    é€€å‡ºç™»å½•
                </button>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="flex-1 ml-64 p-10">

            <header class="mb-8 border-b border-gray-200 pb-4">
                <h2 class="text-3xl font-bold mb-1">å€Ÿé˜…æ€»è§ˆ</h2>
                <p class="text-gray-600 text-sm">ç³»ç»Ÿæ‰€æœ‰å†å²å€Ÿé˜…è®°å½•</p>
            </header>

            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 border-b border-gray-100 text-xs uppercase text-gray-500 font-semibold">
                        <tr>
                            <th class="p-5">è®°å½•ID</th>
                            <th class="p-5">å›¾ä¹¦ä¿¡æ¯</th>
                            <th class="p-5">å€Ÿé˜…ç”¨æˆ·ID</th>
                            <th class="p-5">å€Ÿé˜…æ—¶é—´</th>
                            <th class="p-5">çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <template x-for="record in records" :key="record.id">
                            <tr class="hover:bg-gray-50">
                                <td class="p-5 font-mono text-gray-400 text-sm" x-text="`#${record.id}`"></td>
                                <td class="p-5 font-bold" x-text="getBookTitle(record.bookId)"></td>
                                <td class="p-5 text-sm">User: <span x-text="record.userId"></span></td>
                                <td class="p-5 text-sm text-gray-600">
                                    <div x-text="formatDate(record.borrowTime)"></div>
                                </td>
                                <td class="p-5">
                                    <span class="px-2 py-1 rounded text-xs font-bold"
                                        :class="record.status === 'BORROWED' ? 'bg-black text-white' : 'bg-gray-100 text-gray-400'"
                                        x-text="record.status === 'BORROWED' ? 'å€Ÿé˜…ä¸­' : 'å·²å½’è¿˜'">
                                    </span>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
                <div x-show="records.length === 0" class="p-12 text-center text-gray-400">
                    æš‚æ— å€Ÿé˜…è®°å½•
                </div>
            </div>

        </main>
    </div>

</body>

</html>
```

---

#### **æ­¥éª¤ 7.7.5**ï¼šåˆ›å»ºç”¨æˆ·-å›¾ä¹¦å€Ÿé˜…é¡µé¢

åœ¨ `library-frontend/pages/user/books.html` ä¸­åˆ›å»ºï¼š

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ä¹¦å€Ÿé˜… - æ™ºå›¾Â·äº‘å€Ÿé˜…</title>

    <!-- CDN å¼•å…¥ï¼ˆåŒä¸Šï¼‰ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css">
    <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>
    <!-- å¼•å…¥é…ç½®å’Œå·¥å…·ç±» -->
    <script src="../../js/config.js"></script>
    <script src="../../js/utils/storage.js"></script>
    <script src="../../js/utils/http.js"></script>
    <script src="../../js/api/auth.js"></script>
    <script src="../../js/api/book.js"></script>
    <script src="../../js/api/borrow.js"></script>
    <script src="../../js/modules/user-books.js"></script>

    <style>
        :root {
            --bg-main: #ffffff;
            --bg-secondary: #f9fafb;
            --text-main: #111827;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --accent-color: #000000;
            --accent-hover: #333333;
            --accent-text: #ffffff;
        }

        body {
            background-color: var(--bg-secondary);
            color: var(--text-main);
        }

        #nprogress .bar { background: var(--accent-color) !important; height: 3px !important; }

        .btn-primary {
            background-color: var(--accent-color);
            color: var(--accent-text);
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: var(--accent-hover);
            transform: translateY(-1px);
        }

        [x-cloak] { display: none !important; }
    </style>
</head>

<body class="font-sans antialiased selection:bg-black selection:text-white"
      x-data="userBooksModule()" x-init="init()" x-cloak>

    <div class="min-h-screen flex">

        <!-- ä¾§è¾¹æ  -->
        <aside class="w-64 bg-black text-white flex flex-col fixed inset-y-0 z-20">
            <div class="h-20 flex items-center px-8 border-b border-gray-800">
                <i class="ri-book-mark-fill text-2xl mr-3"></i>
                <span class="text-xl font-bold tracking-wider">æ™ºå›¾ç³»ç»Ÿ</span>
            </div>

            <nav class="flex-1 px-4 py-8 space-y-2">
                <p class="px-4 text-xs text-gray-500 font-bold mb-2 uppercase tracking-widest">ä¸ªäºº</p>
                <a href="books.html"
                   class="flex items-center px-4 py-3 rounded-lg bg-white text-black">
                    <i class="ri-store-2-line mr-3"></i> å›¾ä¹¦å€Ÿé˜…
                </a>
                <a href="records.html"
                   class="flex items-center px-4 py-3 rounded-lg text-gray-400 hover:text-white transition-all duration-300">
                    <i class="ri-history-line mr-3"></i> æˆ‘çš„è®°å½•
                </a>
            </nav>

            <div class="p-6 border-t border-gray-800">
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 rounded bg-gray-700 flex items-center justify-center text-sm font-bold">
                        <span x-text="userInfo.username ? userInfo.username.charAt(0).toUpperCase() : 'U'"></span>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-bold text-white" x-text="userInfo.username"></p>
                        <p class="text-xs text-gray-500" x-text="userInfo.role"></p>
                    </div>
                </div>
                <button @click="logout" class="w-full py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-white rounded text-sm transition-colors">
                    é€€å‡ºç™»å½•
                </button>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="flex-1 ml-64 p-10">

            <header class="mb-8 border-b border-gray-200 pb-4">
                <h2 class="text-3xl font-bold mb-1">é¦†è—å›¾ä¹¦</h2>
                <p class="text-gray-600 text-sm">å‘ç°å¹¶å€Ÿé˜…æ‚¨æ„Ÿå…´è¶£çš„å›¾ä¹¦</p>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <template x-for="book in books" :key="book.id">
                    <div class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm hover:shadow-lg transition-all duration-300 group">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-12 h-16 bg-gray-100 rounded flex items-center justify-center text-gray-300">
                                <i class="ri-book-line text-2xl"></i>
                            </div>
                            <span class="px-2 py-1 bg-gray-50 rounded text-xs font-mono text-gray-400" x-text="`ID:${book.id}`"></span>
                        </div>

                        <h3 class="font-bold text-xl mb-1 truncate" x-text="book.title"></h3>
                        <p class="text-sm text-gray-500 mb-4" x-text="`${book.author} Â· ${book.publisher}`"></p>

                        <div class="flex items-center justify-between mt-auto pt-4 border-t border-gray-50">
                            <div class="text-xs">
                                <span class="block text-gray-400">å‰©ä½™åº“å­˜</span>
                                <span class="text-lg font-bold" :class="book.availableQuantity > 0 ? 'text-black' : 'text-red-500'" x-text="book.availableQuantity"></span>
                            </div>
                            <button @click="borrowBook(book.id)"
                                    :disabled="book.availableQuantity <= 0"
                                    class="px-4 py-2 rounded-lg text-sm font-bold transition-all"
                                    :class="book.availableQuantity > 0 ? 'bg-black text-white hover:bg-gray-800' : 'bg-gray-100 text-gray-400 cursor-not-allowed'">
                                <span x-text="book.availableQuantity > 0 ? 'ç«‹å³å€Ÿé˜…' : 'æš‚æ—¶ç¼ºè´§'"></span>
                            </button>
                        </div>
                    </div>
                </template>
            </div>

            <div x-show="books.length === 0" class="text-center py-20 text-gray-400">
                æš‚æ— å›¾ä¹¦æ•°æ®
            </div>

        </main>
    </div>

</body>
</html>
```

---

#### **æ­¥éª¤ 7.7.6**ï¼šåˆ›å»ºç”¨æˆ·-æˆ‘çš„å€Ÿé˜…è®°å½•é¡µé¢

åœ¨ `library-frontend/pages/user/records.html` ä¸­åˆ›å»ºï¼š

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å€Ÿé˜… - æ™ºå›¾Â·äº‘å€Ÿé˜…</title>

    <!-- CDN å¼•å…¥ï¼ˆåŒä¸Šï¼‰ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css">
    <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>
    <!-- å¼•å…¥é…ç½®å’Œå·¥å…·ç±» -->
    <script src="../../js/config.js"></script>
    <script src="../../js/utils/storage.js"></script>
    <script src="../../js/utils/http.js"></script>
    <script src="../../js/api/auth.js"></script>
    <script src="../../js/api/book.js"></script>
    <script src="../../js/api/borrow.js"></script>
    <script src="../../js/modules/user-records.js"></script>

    <style>
        :root {
            --bg-main: #ffffff;
            --bg-secondary: #f9fafb;
            --text-main: #111827;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --accent-color: #000000;
            --accent-hover: #333333;
            --accent-text: #ffffff;
        }

        body {
            background-color: var(--bg-secondary);
            color: var(--text-main);
        }

        #nprogress .bar { background: var(--accent-color) !important; height: 3px !important; }

        .btn-primary {
            background-color: var(--accent-color);
            color: var(--accent-text);
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: var(--accent-hover);
            transform: translateY(-1px);
        }

        [x-cloak] { display: none !important; }
    </style>
</head>

<body class="font-sans antialiased selection:bg-black selection:text-white"
      x-data="userRecordsModule()" x-init="init()" x-cloak>

    <div class="min-h-screen flex">

        <!-- ä¾§è¾¹æ  -->
        <aside class="w-64 bg-black text-white flex flex-col fixed inset-y-0 z-20">
            <div class="h-20 flex items-center px-8 border-b border-gray-800">
                <i class="ri-book-mark-fill text-2xl mr-3"></i>
                <span class="text-xl font-bold tracking-wider">æ™ºå›¾ç³»ç»Ÿ</span>
            </div>

            <nav class="flex-1 px-4 py-8 space-y-2">
                <p class="px-4 text-xs text-gray-500 font-bold mb-2 uppercase tracking-widest">ä¸ªäºº</p>
                <a href="books.html"
                   class="flex items-center px-4 py-3 rounded-lg text-gray-400 hover:text-white transition-all duration-300">
                    <i class="ri-store-2-line mr-3"></i> å›¾ä¹¦å€Ÿé˜…
                </a>
                <a href="records.html"
                   class="flex items-center px-4 py-3 rounded-lg bg-white text-black">
                    <i class="ri-history-line mr-3"></i> æˆ‘çš„è®°å½•
                </a>
            </nav>

            <div class="p-6 border-t border-gray-800">
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 rounded bg-gray-700 flex items-center justify-center text-sm font-bold">
                        <span x-text="userInfo.username ? userInfo.username.charAt(0).toUpperCase() : 'U'"></span>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-bold text-white" x-text="userInfo.username"></p>
                        <p class="text-xs text-gray-500" x-text="userInfo.role"></p>
                    </div>
                </div>
                <button @click="logout" class="w-full py-2 border border-gray-700 text-gray-400 hover:text-white hover:border-white rounded text-sm transition-colors">
                    é€€å‡ºç™»å½•
                </button>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="flex-1 ml-64 p-10">

            <header class="mb-8 border-b border-gray-200 pb-4">
                <h2 class="text-3xl font-bold mb-1">æˆ‘çš„å€Ÿé˜…</h2>
                <p class="text-gray-600 text-sm">æŸ¥çœ‹å€Ÿé˜…å†å²ä¸å½’è¿˜å›¾ä¹¦</p>
            </header>

            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 border-b border-gray-100 text-xs uppercase text-gray-500 font-semibold">
                        <tr>
                            <th class="p-5">è®°å½•ID</th>
                            <th class="p-5">å›¾ä¹¦ä¿¡æ¯</th>
                            <th class="p-5">å€Ÿé˜…æ—¶é—´</th>
                            <th class="p-5">çŠ¶æ€</th>
                            <th class="p-5 text-right">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <template x-for="record in records" :key="record.id">
                            <tr class="hover:bg-gray-50">
                                <td class="p-5 font-mono text-gray-400 text-sm" x-text="`#${record.id}`"></td>
                                <td class="p-5">
                                    <div class="font-bold" x-text="getBookTitle(record.bookId)"></div>
                                </td>
                                <td class="p-5 text-sm text-gray-600">
                                    <div x-text="formatDate(record.borrowTime)"></div>
                                    <div x-show="record.returnTime" class="text-xs text-gray-400 mt-1">
                                        å½’è¿˜äº: <span x-text="formatDate(record.returnTime)"></span>
                                    </div>
                                </td>
                                <td class="p-5">
                                    <span class="px-2 py-1 rounded text-xs font-bold"
                                          :class="record.status === 'BORROWED' ? 'bg-black text-white' : 'bg-gray-100 text-gray-400'"
                                          x-text="record.status === 'BORROWED' ? 'å€Ÿé˜…ä¸­' : 'å·²å½’è¿˜'">
                                    </span>
                                </td>
                                <td class="p-5 text-right">
                                    <button x-show="record.status === 'BORROWED'"
                                            @click="returnBook(record.id)"
                                            class="text-sm font-bold text-black border border-black px-3 py-1 rounded hover:bg-black hover:text-white transition-colors">
                                        å½’è¿˜
                                    </button>
                                    <span x-show="record.status === 'RETURNED'" class="text-gray-300 text-sm">-</span>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
                <div x-show="records.length === 0" class="p-12 text-center text-gray-400">
                    æš‚æ— å€Ÿé˜…è®°å½•
                </div>
            </div>

        </main>
    </div>

</body>
</html>
```

---

### 7.8 å¯åŠ¨ä¸æµ‹è¯•

#### **æ­¥éª¤ 7.8.1**ï¼šå¯åŠ¨åç«¯é¡¹ç›®

ç¡®ä¿åç«¯é¡¹ç›® `library` å·²å¯åŠ¨ï¼Œç›‘å¬åœ¨ `http://localhost:8080`ã€‚

---

**æ­¥éª¤ 7.8.2**ï¼šå¯åŠ¨å‰ç«¯é¡¹ç›®

å‰ç«¯é¡¹ç›®éœ€è¦é€šè¿‡ HTTP æœåŠ¡å™¨è®¿é—®ï¼ˆä¸èƒ½ç›´æ¥åŒå‡» HTML æ–‡ä»¶ï¼Œå¦åˆ™ä¼šå‡ºç°è·¨åŸŸé—®é¢˜ï¼‰ã€‚

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ VS Code çš„ Live Server æ’ä»¶**

1. åœ¨ VS Code ä¸­æ‰“å¼€ `library-frontend` æ–‡ä»¶å¤¹
2. å®‰è£… `Live Server` æ’ä»¶
3. å³é”®ç‚¹å‡» `index.html`ï¼Œé€‰æ‹© `Open with Live Server`
4. æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€ `http://127.0.0.1:5500/index.html`

**æ–¹æ³•äºŒï¼šä½¿ç”¨ Python å†…ç½®æœåŠ¡å™¨**

åœ¨ `library-frontend` ç›®å½•ä¸‹æ‰§è¡Œï¼š

```bash
# Python 3
python -m http.server 5500

# Python 2
python -m SimpleHTTPServer 5500
```

ç„¶åè®¿é—® `http://localhost:5500/index.html`

---

**æ­¥éª¤ 7.8.3**ï¼šæµ‹è¯•æµç¨‹

**æµ‹è¯• 1ï¼šç™»å½•åŠŸèƒ½**
1. è®¿é—® `http://localhost:5500/index.html`ï¼Œè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
2. è¾“å…¥ `admin` / `admin123`ï¼Œç‚¹å‡»ç™»å½•
3. æˆåŠŸåè·³è½¬åˆ° `pages/admin/books.html`

**æµ‹è¯• 2ï¼šå›¾ä¹¦ç®¡ç†ï¼ˆç®¡ç†å‘˜ï¼‰**
1. ç‚¹å‡» "æ–°å¢å›¾ä¹¦" æŒ‰é’®
2. å¡«å†™å›¾ä¹¦ä¿¡æ¯ï¼Œç‚¹å‡»ä¿å­˜
3. è§‚å¯Ÿåˆ—è¡¨æ˜¯å¦åˆ·æ–°ï¼Œæ•°æ®åº“ä¸­æ˜¯å¦æ–°å¢è®°å½•

**æµ‹è¯• 3ï¼šå€Ÿé˜…åŠŸèƒ½ï¼ˆç”¨æˆ·ï¼‰**
1. é€€å‡ºç™»å½•ï¼Œä½¿ç”¨ `user1` / `user123` ç™»å½•
2. åœ¨å›¾ä¹¦å€Ÿé˜…é¡µé¢ç‚¹å‡» "ç«‹å³å€Ÿé˜…"
3. è·³è½¬åˆ° "æˆ‘çš„è®°å½•" é¡µé¢ï¼ŒæŸ¥çœ‹å€Ÿé˜…è®°å½•
4. ç‚¹å‡» "å½’è¿˜" æŒ‰é’®ï¼Œè§‚å¯ŸçŠ¶æ€å˜åŒ–

---

**æ­¥éª¤ 7.8.4**ï¼šå¸¸è§é—®é¢˜æ’æŸ¥

**é—®é¢˜ 1ï¼šè·¨åŸŸé”™è¯¯ï¼ˆCORSï¼‰**

æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºï¼š
```
Access to fetch at 'http://localhost:8080/api/login' from origin 'http://localhost:5500' has been blocked by CORS policy
```

**åŸå› **ï¼šåç«¯æœªé…ç½®è·¨åŸŸ

**è§£å†³**ï¼šæ£€æŸ¥åç«¯ `WebConfig.java` ä¸­çš„ `addCorsMappings` æ–¹æ³•æ˜¯å¦æ­£ç¡®é…ç½®

---

**é—®é¢˜ 2ï¼šToken æ— æ•ˆï¼ˆ401ï¼‰**

æ¥å£è¿”å› 401 çŠ¶æ€ç 

**åŸå› **ï¼šToken è¿‡æœŸæˆ–æ ¼å¼é”™è¯¯

**è§£å†³**ï¼š
1. æ¸…ç©ºæµè§ˆå™¨ `localStorage`ï¼ˆF12 -> Application -> Local Storage -> å³é”® Clearï¼‰
2. é‡æ–°ç™»å½•

---

**é—®é¢˜ 3ï¼šé¡µé¢ç©ºç™½**

æ‰“å¼€é¡µé¢åä¸€ç‰‡ç©ºç™½

**åŸå› **ï¼šJS æ–‡ä»¶è·¯å¾„é”™è¯¯

**è§£å†³**ï¼š
1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰ 404 é”™è¯¯
2. æ£€æŸ¥ HTML ä¸­çš„ `<script src="...">` è·¯å¾„æ˜¯å¦æ­£ç¡®
3. ç¡®ä¿ç›¸å¯¹è·¯å¾„æ­£ç¡®ï¼ˆå¦‚ `../../js/config.js`ï¼‰

---

### 7.9 å‰ç«¯æ¶æ„æ€»ç»“

**åˆ†å±‚ä¼˜åŠ¿å›é¡¾**ï¼š

| å±‚çº§ | èŒè´£ | ä¼˜åŠ¿ |
|------|------|------|
| **é…ç½®å±‚** | ç®¡ç† API åœ°å€ã€å¸¸é‡ | ç¯å¢ƒåˆ‡æ¢åªéœ€ä¿®æ”¹ä¸€å¤„ |
| **å·¥å…·å±‚** | å°è£… HTTP è¯·æ±‚ã€å­˜å‚¨ | ç»Ÿä¸€å¤„ç† Tokenã€é”™è¯¯ï¼Œé¿å…é‡å¤ä»£ç  |
| **API å±‚** | å°è£…æ¥å£è°ƒç”¨ | æŒ‰ä¸šåŠ¡æ¨¡å—æ‹†åˆ†ï¼Œæ˜“äºç»´æŠ¤å’Œå¤ç”¨ |
| **ä¸šåŠ¡å±‚** | å¤„ç†é¡µé¢é€»è¾‘ | æ¯ä¸ªé¡µé¢ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰° |
| **é¡µé¢å±‚** | å±•ç¤º UI | é€šè¿‡ Alpine.js ç»‘å®šæ•°æ®ï¼Œå®ç°å“åº”å¼æ›´æ–° |

**ä¸ºä»€ä¹ˆè¿™æ ·åˆ†å±‚ï¼Ÿ**
- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ä¸€ä»¶äº‹ï¼Œä¿®æ”¹æŸä¸ªåŠŸèƒ½æ—¶åªéœ€å®šä½åˆ°å¯¹åº”æ–‡ä»¶
- **é¿å…å†—ä½™**ï¼šå·¥å…·å‡½æ•°å’Œ API è°ƒç”¨å¯ä»¥åœ¨å¤šä¸ªé¡µé¢ä¸­å¤ç”¨
- **ä¾¿äºåä½œ**ï¼šå‰ç«¯å›¢é˜Ÿå¯ä»¥å¹¶è¡Œå¼€å‘ä¸åŒçš„é¡µé¢ï¼Œäº’ä¸å¹²æ‰°
- **æ˜“äºæµ‹è¯•**ï¼šå¯ä»¥å•ç‹¬æµ‹è¯•æŸä¸ªæ¨¡å—çš„åŠŸèƒ½ï¼Œæ— éœ€å¯åŠ¨æ•´ä¸ªé¡¹ç›®
- **æ˜“äºæ‰©å±•**ï¼šæ–°å¢åŠŸèƒ½æ—¶ï¼Œåªéœ€æ·»åŠ å¯¹åº”çš„ API æ–‡ä»¶å’Œä¸šåŠ¡é€»è¾‘æ–‡ä»¶

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š
- **å‰åç«¯åˆ†ç¦»**ï¼šå‰ç«¯ç‹¬ç«‹éƒ¨ç½²ï¼Œé€šè¿‡ HTTP è¯·æ±‚è°ƒç”¨åç«¯æ¥å£
- **å¤šé¡µé¢åº”ç”¨**ï¼šæ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹æˆé¡µï¼Œé€šè¿‡ `<a>` æ ‡ç­¾è·³è½¬
- **ç»Ÿä¸€æ‹¦æˆª**ï¼šHTTP å·¥å…·ç±»è‡ªåŠ¨æ·»åŠ  Tokenï¼Œç»Ÿä¸€å¤„ç†é”™è¯¯
- **æƒé™æ§åˆ¶**ï¼šæ¯ä¸ªé¡µé¢åˆå§‹åŒ–æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€å’Œè§’è‰²æƒé™


---

## 8. é¡¹ç›®ç»“æ„æ€»è§ˆ

æœ€ç»ˆçš„é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
å·¥ä½œç©ºé—´/
â”œâ”€â”€ library/                              # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/main/java/com/example/library/
â”‚   â”‚   â”œâ”€â”€ LibraryApplication.java       # ä¸»å¯åŠ¨ç±»
â”‚   â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”‚   â””â”€â”€ Result.java               # ç»Ÿä¸€å“åº”ç±»
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â””â”€â”€ WebConfig.java            # Web é…ç½®ï¼ˆæ‹¦æˆªå™¨ã€è·¨åŸŸï¼‰
â”‚   â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthController.java       # ç™»å½•æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ BookController.java       # å›¾ä¹¦ç®¡ç†æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â””â”€â”€ BorrowController.java     # å€Ÿé˜…ç®¡ç†æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â””â”€â”€ LoginDTO.java             # ç™»å½•è¯·æ±‚ DTO
â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”‚   â”œâ”€â”€ User.java                 # ç”¨æˆ·å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ Book.java                 # å›¾ä¹¦å®ä½“
â”‚   â”‚   â”‚   â””â”€â”€ BorrowRecord.java         # å€Ÿé˜…è®°å½•å®ä½“
â”‚   â”‚   â”œâ”€â”€ interceptor/
â”‚   â”‚   â”‚   â””â”€â”€ LoginInterceptor.java     # ç™»å½•æ‹¦æˆªå™¨
â”‚   â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â”‚   â”œâ”€â”€ UserMapper.java           # ç”¨æˆ·æ•°æ®è®¿é—®æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ BookMapper.java           # å›¾ä¹¦æ•°æ®è®¿é—®æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ BorrowRecordMapper.java   # å€Ÿé˜…è®°å½•æ•°æ®è®¿é—®æ¥å£
â”‚   â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”‚   â””â”€â”€ BorrowService.java        # å€Ÿé˜…ä¸šåŠ¡ç±»
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ JwtUtils.java             # JWT å·¥å…·ç±»
â”‚   â”œâ”€â”€ src/main/resources/
â”‚   â”‚   â””â”€â”€ application.yml               # åº”ç”¨é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ pom.xml                           # Maven ä¾èµ–é…ç½®
â”‚
â””â”€â”€ library-frontend/                     # å‰ç«¯é¡¹ç›®
    â”œâ”€â”€ index.html                        # å…¥å£é¡µé¢ï¼ˆè‡ªåŠ¨è·³è½¬ï¼‰
    â”œâ”€â”€ pages/                            # é¡µé¢ç›®å½•
    â”‚   â”œâ”€â”€ login.html                    # ç™»å½•é¡µé¢
    â”‚   â”œâ”€â”€ admin/                        # ç®¡ç†å‘˜é¡µé¢ç›®å½•
    â”‚   â”‚   â”œâ”€â”€ books.html                # å›¾ä¹¦ç®¡ç†é¡µé¢
    â”‚   â”‚   â””â”€â”€ records.html              # å€Ÿé˜…æ€»è§ˆé¡µé¢
    â”‚   â””â”€â”€ user/                         # ç”¨æˆ·é¡µé¢ç›®å½•
    â”‚       â”œâ”€â”€ books.html                # å›¾ä¹¦å€Ÿé˜…é¡µé¢
    â”‚       â””â”€â”€ records.html              # æˆ‘çš„å€Ÿé˜…è®°å½•é¡µé¢
    â”œâ”€â”€ js/
    â”‚   â”œâ”€â”€ config.js                     # å…¨å±€é…ç½®
    â”‚   â”œâ”€â”€ utils/                        # å·¥å…·å‡½æ•°ç›®å½•
    â”‚   â”‚   â”œâ”€â”€ http.js                   # HTTP è¯·æ±‚å°è£…ï¼ˆåŸºäº Axiosï¼‰
    â”‚   â”‚   â””â”€â”€ storage.js                # æœ¬åœ°å­˜å‚¨å°è£…
    â”‚   â”œâ”€â”€ api/                          # API æ¥å£ç›®å½•
    â”‚   â”‚   â”œâ”€â”€ auth.js                   # è®¤è¯æ¥å£
    â”‚   â”‚   â”œâ”€â”€ book.js                   # å›¾ä¹¦ç®¡ç†æ¥å£
    â”‚   â”‚   â””â”€â”€ borrow.js                 # å€Ÿé˜…ç®¡ç†æ¥å£
    â”‚   â””â”€â”€ modules/                      # ä¸šåŠ¡é€»è¾‘æ¨¡å—
    â”‚       â”œâ”€â”€ login.js                  # ç™»å½•é¡µé¢é€»è¾‘
    â”‚       â”œâ”€â”€ admin-books.js            # ç®¡ç†å‘˜-å›¾ä¹¦ç®¡ç†é€»è¾‘
    â”‚       â”œâ”€â”€ admin-records.js          # ç®¡ç†å‘˜-å€Ÿé˜…æ€»è§ˆé€»è¾‘
    â”‚       â”œâ”€â”€ user-books.js             # ç”¨æˆ·-å›¾ä¹¦å€Ÿé˜…é€»è¾‘
    â”‚       â””â”€â”€ user-records.js           # ç”¨æˆ·-æˆ‘çš„è®°å½•é€»è¾‘
    â”œâ”€â”€ css/
    â”‚   â””â”€â”€ common.css                    # å…¬å…±æ ·å¼ï¼ˆå¯é€‰ï¼‰
    â””â”€â”€ assets/                           # é™æ€èµ„æº
        â””â”€â”€ logo.png                      # ç½‘ç«™ Logo
```

---

## 9. æ ¸å¿ƒæŠ€æœ¯ç‚¹æ€»ç»“

### 9.1 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ç‚¹ | ä½œç”¨ | å…³é”®ç±»/æ³¨è§£ |
|--------|------|------------|
| **Spring Boot** | å¿«é€Ÿæ­å»º Web åº”ç”¨ | `@RestController`, `@RequestMapping` |
| **MyBatis-Plus** | ç®€åŒ–æ•°æ®åº“æ“ä½œ | `BaseMapper`, `LambdaQueryWrapper` |
| **Hutool JWT** | ç”Ÿæˆå’ŒéªŒè¯ Token | `JWTUtil.createToken()`, `JWTUtil.verify()` |
| **æ‹¦æˆªå™¨** | ç»Ÿä¸€éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€ | `HandlerInterceptor`, `WebMvcConfigurer` |
| **äº‹åŠ¡ç®¡ç†** | ä¿è¯æ•°æ®ä¸€è‡´æ€§ | `@Transactional` |
| **DTO æ¨¡å¼** | æ§åˆ¶å‰åç«¯æ•°æ®ä¼ è¾“ | `LoginDTO` |
| **ç»Ÿä¸€å“åº”** | è§„èŒƒæ¥å£è¿”å›æ ¼å¼ | `Result<T>` |
| **è·¨åŸŸé…ç½®** | å…è®¸å‰ç«¯è·¨åŸŸè®¿é—® | `addCorsMappings()` |

### 9.2 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ç‚¹ | ä½œç”¨ | å…³é”®åº“/å·¥å…· |
|--------|------|------------|
| **Tailwind CSS** | å¿«é€Ÿæ„å»º UI æ ·å¼ | CDN å¼•å…¥ |
| **Alpine.js** | è½»é‡çº§å“åº”å¼æ¡†æ¶ | `x-data`, `x-init`, `x-model` |
| **Axios** | HTTP è¯·æ±‚åº“ | è¯·æ±‚/å“åº”æ‹¦æˆªå™¨ |
| **SweetAlert2** | ç¾åŒ–å¼¹çª—æç¤º | `Swal.fire()` |
| **NProgress** | é¡µé¢åŠ è½½è¿›åº¦æ¡ | `NProgress.start()`, `NProgress.done()` |
| **RemixIcon** | å›¾æ ‡åº“ | `<i class="ri-xxx">` |
| **Animate.css** | CSS åŠ¨ç”»åº“ | `animate__animated` |

### 9.3 å‰åç«¯åˆ†ç¦»æ¶æ„

| å±‚çº§ | åç«¯èŒè´£ | å‰ç«¯èŒè´£ |
|------|---------|---------|
| **è¡¨ç°å±‚** | æä¾› RESTful API | é¡µé¢æ¸²æŸ“ã€ç”¨æˆ·äº¤äº’ |
| **ä¸šåŠ¡å±‚** | å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼ˆServiceï¼‰ | è°ƒç”¨ APIã€æ•°æ®ç»‘å®šï¼ˆmodulesï¼‰ |
| **æ•°æ®å±‚** | æ•°æ®åº“æ“ä½œï¼ˆMapperï¼‰ | æœ¬åœ°å­˜å‚¨ï¼ˆlocalStorageï¼‰ |
| **å·¥å…·å±‚** | JWT ç”Ÿæˆ/éªŒè¯ | HTTP è¯·æ±‚å°è£…ã€å­˜å‚¨å°è£… |

### 9.4 å…³é”®è®¾è®¡æ¨¡å¼

**åç«¯**ï¼š
- **ä¸‰å±‚æ¶æ„**ï¼šControllerï¼ˆæ§åˆ¶å±‚ï¼‰â†’ Serviceï¼ˆä¸šåŠ¡å±‚ï¼‰â†’ Mapperï¼ˆæ•°æ®å±‚ï¼‰
- **DTO æ¨¡å¼**ï¼šå‰ç«¯ä¼ æ¥çš„æ•°æ®ç”¨ DTO æ¥æ”¶ï¼Œé¿å…ç›´æ¥ä½¿ç”¨å®ä½“ç±»
- **ç»Ÿä¸€å“åº”**ï¼šæ‰€æœ‰æ¥å£è¿”å› `Result<T>` æ ¼å¼ï¼Œå‰ç«¯ç»Ÿä¸€å¤„ç†
- **æ‹¦æˆªå™¨æ¨¡å¼**ï¼šç»Ÿä¸€éªŒè¯ Tokenï¼Œé¿å…åœ¨æ¯ä¸ªæ¥å£ä¸­é‡å¤ç¼–å†™

**å‰ç«¯**ï¼š
- **åˆ†å±‚æ¶æ„**ï¼šé…ç½®å±‚ â†’ å·¥å…·å±‚ â†’ API å±‚ â†’ ä¸šåŠ¡å±‚ â†’ é¡µé¢å±‚
- **å¤šé¡µé¢åº”ç”¨**ï¼šæ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹æˆé¡µï¼Œé€šè¿‡ `<a>` æ ‡ç­¾è·³è½¬
- **è¯·æ±‚æ‹¦æˆª**ï¼šAxios æ‹¦æˆªå™¨è‡ªåŠ¨æ·»åŠ  Tokenã€å¤„ç†é”™è¯¯
- **æ¨¡å—åŒ–å¼€å‘**ï¼šæ¯ä¸ªé¡µé¢å¯¹åº”ä¸€ä¸ªä¸šåŠ¡é€»è¾‘æ–‡ä»¶ï¼Œé¿å…ä»£ç æ··æ‚

---
