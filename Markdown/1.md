---

# 图书借阅系统开发实训 - 第一天

**实训主题**：用户登录与角色跳转
**技术栈**：Spring Boot 3.5.9 + MyBatis-Plus 3.5.7 + MySQL + HTML/Axios
**认证方式**：原生拦截器 + Hutool JWT

---

## 📌 今日目标

完成用户登录功能，实现根据用户角色（管理员 ADMIN / 普通用户 USER）自动跳转到不同的系统页面。

---

## ✅ 今日验收标准

在开始操作前，请明确今天需要达成的验收目标：

- [ ] **后端启动成功**：Spring Boot 项目能够正常启动，控制台无红色错误
- [ ] **数据库初始化完成**：`library_db` 数据库已创建，三张表（user、book、borrow_record）结构正确
- [ ] **登录页面可访问**：前端项目启动后，能够正常访问登录页面
- [ ] **多角色登录测试通过**：
  - 使用 `admin` / `admin123` 登录后，跳转到 `/pages/admin/books.html`
  - 使用 `user1` / `user123` 登录后，跳转到 `/pages/user/books.html`
- [ ] **Token 机制生效**：登录成功后，浏览器 localStorage 中存储了 Token

---

## 第一步：数据库环境构建（预计用时：30 分钟）

> 📖 **完整参考**：请查看完整操作手册 **第 1 节：数据库环境构建**

### 操作要点

1. **创建数据库**
   - 打开 MySQL 数据库管理工具（Navicat / SQLyog / MySQL Workbench）
   - 执行完整手册中 **步骤 1.1** 的 SQL 语句，创建 `library_db` 数据库

2. **执行建表脚本**
   - 复制完整手册中 **步骤 1.2** 的完整建表 SQL
   - 依次创建三张表：`book`（图书表）、`user`（用户表）、`borrow_record`（借阅记录表）
   - 插入初始测试数据（2 个用户、2 本图书）

3. **理解表关系**
   - 阅读完整手册中 **步骤 1.3** 的表关系说明
   - 重点理解：`borrow_record` 是中间表，通过 `book_id` 和 `user_id` 建立"谁借了什么书"的联系

### ⚠️ 注意事项

- 确保 MySQL 服务已启动
- 数据库字符集必须为 `utf8mb4`
- 初始密码为明文存储（实际项目应加密），测试账号：
  - 管理员：`admin` / `admin123`
  - 普通用户：`user1` / `user123`

---

## 第二步：后端项目初始化（预计用时：30 分钟）

> 📖 **完整参考**：请查看完整操作手册 **第 2 节：后端项目初始化**

### 操作要点

1. **创建 Spring Boot 项目**
   - 参考完整手册 **步骤 2.1**，使用 IDEA 或 Spring Initializr 创建项目
   - **重要**：Spring Boot 版本选择 `3.5.9`（不要选择 4.0.0）
   - Group: `com.example`，Artifact: `library`

2. **配置 Maven 依赖**
   - 打开项目根目录下的 `pom.xml`
   - 完整复制手册 **步骤 2.2** 中的依赖配置
   - 关键依赖说明：
     - `spring-boot-starter-web`：提供 RESTful API 支持
     - `mysql-connector-j`：MySQL 数据库驱动
     - `mybatis-plus-spring-boot3-starter`：简化数据库操作
     - `hutool-all`：提供 JWT 工具类

3. **配置数据库连接**
   - 编辑 `src/main/resources/application.yml`
   - 复制手册 **步骤 2.3** 中的配置内容
   - **务必修改**：将 `password: root` 改为你的 MySQL 实际密码

### ⚠️ 注意事项

- 依赖下载可能需要几分钟，请耐心等待
- 如果 Maven 下载失败，检查网络或切换阿里云镜像
- `application.yml` 中的缩进必须使用空格，不能用 Tab

---

## 第三步：后端通用模块开发（预计用时：30 分钟）

> 📖 **完整参考**：请查看完整操作手册 **第 3 节：后端通用模块开发**

### 操作要点

1. **创建统一响应类**
   - 在 `src/main/java/com/example/library/common` 包下创建 `Result.java`
   - 复制手册 **步骤 3.1** 中的完整代码
   - **作用**：所有接口返回的数据都用这个类包装，前端可以统一处理

2. **创建 JWT 工具类**
   - 在 `src/main/java/com/example/library/utils` 包下创建 `JwtUtils.java`
   - 复制手册 **步骤 3.2** 中的完整代码
   - **作用**：生成和解析用户登录凭证（Token）

### 💡 知识点提示

- **为什么需要统一响应类？**
  前端发送请求后，需要知道操作是否成功、失败原因是什么、返回了什么数据。统一格式后，前端只需判断 `code` 是否为 200。

- **JWT 的组成**：由三部分组成（Header.Payload.Signature），用 `.` 分隔
  - **Payload（载荷）**：存放用户信息（如 userId、role）
  - **Signature（签名）**：用密钥加密，防止 Token 被篡改

---

## 第四步：实体类和 DAO 层开发（预计用时：30 分钟）

> 📖 **完整参考**：请查看完整操作手册 **第 4 节：数据传输对象（DTO）与实体层开发**

### 操作要点

1. **创建登录请求 DTO**
   - 在 `src/main/java/com/example/library/dto` 包下创建 `LoginDTO.java`
   - 复制手册 **步骤 4.1** 中的代码
   - **作用**：前端提交登录表单时，数据会自动封装到这个对象中

2. **创建实体类**
   - 在 `src/main/java/com/example/library/entity` 包下创建三个实体类：
     - `User.java`（用户表实体）
     - `Book.java`（图书表实体）
     - `BorrowRecord.java`（借阅记录表实体）
   - 复制手册 **步骤 4.2** 中的完整代码

3. **创建 Mapper 接口**
   - 在 `src/main/java/com/example/library/mapper` 包下创建三个接口：
     - `UserMapper.java`
     - `BookMapper.java`
     - `BorrowRecordMapper.java`
   - 复制手册 **步骤 4.3** 中的代码
   - **重点**：继承 `BaseMapper` 后，自动拥有增删改查方法，无需编写 SQL

### 💡 知识点提示

- **为什么需要 DTO？**
  前端传来的数据可能只包含部分字段（如登录只需要用户名和密码），直接用实体类接收会导致其他字段为 null，且不安全。

- **MyBatis-Plus 的核心优势**：
  传统 MyBatis 需要在 XML 文件中编写 SQL 语句，MyBatis-Plus 通过继承 `BaseMapper`，自动生成常用的 CRUD 方法。

---

## 第五步：登录认证与拦截器开发（预计用时：40 分钟）

> 📖 **完整参考**：请查看完整操作手册 **第 5 节：登录认证与拦截器开发**

### 操作要点

1. **创建登录拦截器**
   - 在 `src/main/java/com/example/library/interceptor` 包下创建 `LoginInterceptor.java`
   - 复制手册 **步骤 5.1** 中的完整代码
   - **作用**：拦截所有需要登录才能访问的接口，验证 Token 是否有效

2. **注册拦截器**
   - 在 `src/main/java/com/example/library/config` 包下创建 `WebConfig.java`
   - 复制手册 **步骤 5.2** 中的完整代码
   - **重点配置**：
     - 拦截路径：`/api/**`（所有以 `/api` 开头的请求）
     - 放行路径：`/api/login`（登录接口不需要验证 Token）
     - 跨域配置：允许前端页面调用后端接口

### 💡 知识点提示

- **拦截器的作用**：在请求到达 Controller 之前进行统一处理（如权限验证、日志记录）
- **为什么要验证 Token**：防止未登录用户直接访问需要权限的接口
- **跨域配置**：前端页面（如 `http://localhost:5500`）访问后端接口（`http://localhost:8080`）时，浏览器会拦截，需要配置跨域

---

## 第六步：登录控制器开发（预计用时：20 分钟）

> 📖 **完整参考**：请查看完整操作手册 **第 6.1 节：实现登录控制器**

### 操作要点

1. **创建认证控制器**
   - 在 `src/main/java/com/example/library/controller` 包下创建 `AuthController.java`
   - 复制手册 **步骤 6.1** 中的完整代码
   - **核心逻辑**：
     1. 接收前端提交的用户名和密码
     2. 查询数据库验证用户是否存在
     3. 生成 JWT Token
     4. 返回 Token 和用户角色给前端

### 💡 知识点提示

- **LambdaQueryWrapper**：MyBatis-Plus 提供的条件构造器，使用 Lambda 表达式避免字段名写错
- **@RequestBody**：将前端提交的 JSON 数据自动转换为 Java 对象
- **为什么不直接返回 User 对象**：密码等敏感信息不应该返回给前端

---

## 第七步：前端项目开发（预计用时：60 分钟）

> 📖 **完整参考**：请查看完整操作手册 **第 7 节：前端页面开发**

### 操作要点

#### 7.1 创建前端项目目录

- 在后端项目 `library` 的**同级目录**下创建 `library-frontend` 文件夹
- 按照手册 **步骤 7.2** 的目录结构创建文件夹和文件

#### 7.2 配置层开发

- 创建 `js/config.js`，复制手册 **步骤 7.3.1** 的代码
- **作用**：集中管理 API 地址、Token 键名等常量

#### 7.3 工具层开发

- 创建 `js/utils/storage.js`，复制手册 **步骤 7.4.1** 的代码
- 创建 `js/utils/http.js`，复制手册 **步骤 7.4.2** 的代码
- **作用**：封装本地存储和 HTTP 请求，统一处理 Token、错误、加载状态

#### 7.4 API 层开发

- 创建 `js/api/auth.js`，复制手册 **步骤 7.5.1** 的代码
- **作用**：封装登录接口调用

#### 7.5 业务逻辑层开发

- 创建 `js/modules/login.js`，复制手册 **步骤 7.6.1** 的代码
- **作用**：处理登录页面的业务逻辑（表单验证、调用 API、跳转页面）

#### 7.6 页面开发

- 创建 `index.html`，复制手册 **步骤 7.7.1** 的代码
- 创建 `pages/login.html`，复制手册 **步骤 7.7.2** 的代码

### ⚠️ 注意事项

- **Axios 必须在其他 JS 文件之前引入**，否则会报错 `axios is not defined`
- 所有 HTML 文件的 `<head>` 标签中，引入顺序为：
  1. Axios CDN
  2. config.js
  3. utils/*.js
  4. api/*.js
  5. modules/*.js

### 💡 知识点提示

- **为什么要分层？**
  配置层 → 工具层 → API 层 → 业务层 → 页面层，每个文件只负责一件事，修改某个功能时只需定位到对应文件。

- **前后端分离的优势**：
  - 前端和后端可以同时开发，互不干扰
  - 前端可以部署到 Nginx、CDN 等静态服务器
  - 前端可以自由选择技术栈（Vue、React、Angular）

---

## 第八步：启动与测试（预计用时：20 分钟）

> 📖 **完整参考**：请查看完整操作手册 **第 7.8 节：启动与测试**

### 操作要点

#### 8.1 启动后端项目

1. 在 IDEA 中找到 `LibraryApplication.java`（主启动类）
2. 右键点击 → Run 'LibraryApplication'
3. 观察控制台，确认启动成功（看到 "Started LibraryApplication in X seconds"）

#### 8.2 启动前端项目

**方法一：使用 VS Code 的 Live Server 插件**
1. 在 VS Code 中打开 `library-frontend` 文件夹
2. 安装 `Live Server` 插件
3. 右键点击 `index.html`，选择 `Open with Live Server`
4. 浏览器自动打开 `http://127.0.0.1:5500/index.html`

**方法二：使用 Python 内置服务器**
```bash
# 在 library-frontend 目录下执行
python -m http.server 5500
```
然后访问 `http://localhost:5500/index.html`

#### 8.3 测试登录功能

**测试 1：管理员登录**
1. 访问 `http://localhost:5500/index.html`，自动跳转到登录页
2. 输入 `admin` / `admin123`，点击登录
3. 观察浏览器顶部是否出现红色加载条（NProgress）
4. 登录成功后，应该跳转到 `http://localhost:5500/pages/admin/books.html`
5. **注意**：此时页面是空白的，这是正常现象（第二天才会开发管理员页面）

**测试 2：普通用户登录**
1. 点击浏览器的后退按钮，回到登录页
2. 输入 `user1` / `user123`，点击登录
3. 登录成功后，应该跳转到 `http://localhost:5500/pages/user/books.html`
4. **注意**：此时页面也是空白的（第三天才会开发用户页面）

**测试 3：验证 Token 存储**
1. 登录成功后，按 `F12` 打开浏览器开发者工具
2. 切换到 `Application` 标签（Chrome）或 `Storage` 标签（Firefox）
3. 展开 `Local Storage` → `http://localhost:5500`
4. 确认存在以下三个键：
   - `library_token`：存储 JWT Token
   - `library_role`：存储用户角色（ADMIN 或 USER）
   - `library_username`：存储用户名

---

## ✅ 第一天验收检查清单

请逐项检查以下内容，确保全部通过后再进入第二天的学习：

### 数据库检查

- [ ] 数据库 `library_db` 已创建
- [ ] 三张表（user、book、borrow_record）已创建
- [ ] 初始测试数据已插入（2 个用户、2 本图书）
- [ ] 在 Navicat 中执行 `SELECT * FROM user;` 能看到 admin 和 user1

### 后端检查

- [ ] Spring Boot 项目能够正常启动
- [ ] 控制台显示 "Started LibraryApplication in X seconds"
- [ ] 控制台无红色错误日志
- [ ] 访问 `http://localhost:8080` 显示 Whitelabel Error Page（这是正常的，说明服务已启动）

### 前端检查

- [ ] 访问 `http://localhost:5500/index.html` 自动跳转到登录页
- [ ] 登录页面样式正常显示（黑白极简风格）
- [ ] 浏览器控制台（F12 → Console）无红色错误
- [ ] 浏览器控制台（F12 → Network）能看到对 `http://localhost:8080/api/login` 的请求

### 功能检查

- [ ] 使用 `admin` / `admin123` 登录成功
- [ ] 登录后跳转到 `/pages/admin/books.html`（虽然页面是空的，但 URL 正确）
- [ ] 浏览器 localStorage 中存储了 Token、role、username
- [ ] 退出登录（清空 localStorage），使用 `user1` / `user123` 登录成功
- [ ] 登录后跳转到 `/pages/user/books.html`（虽然页面是空的，但 URL 正确）

---

## 🐛 常见问题排查

### 问题 1：数据库连接失败

**现象**：后端启动时报错 `Communications link failure`

**解决方案**：
1. 检查 MySQL 服务是否启动（Windows：任务管理器 → 服务 → MySQL）
2. 检查 `application.yml` 中的数据库密码是否正确
3. 检查数据库名称是否为 `library_db`
4. 尝试在 Navicat 中手动连接数据库，确认连接信息正确

---

### 问题 2：前端跨域错误

**现象**：浏览器控制台显示 `Access to fetch at 'http://localhost:8080/api/login' has been blocked by CORS policy`

**解决方案**：
1. 检查后端 `WebConfig.java` 中的跨域配置是否正确
2. 确保后端项目已启动
3. 清空浏览器缓存后重试（Ctrl + Shift + Delete）
4. 尝试使用无痕模式（Ctrl + Shift + N）访问

---

### 问题 3：登录后页面空白

**现象**：登录成功但跳转后页面是空白的

**解决方案**：
这是**正常现象**！第一天只完成了登录功能，管理员和用户的主页面将在第二天和第三天开发。

**如何验证登录成功？**
1. 观察浏览器地址栏，URL 是否正确跳转（admin 跳转到 `/pages/admin/books.html`，user 跳转到 `/pages/user/books.html`）
2. 按 F12 打开开发者工具，查看 localStorage 中是否存储了 Token

---

### 问题 4：Axios 报错 `axios is not defined`

**现象**：浏览器控制台显示 `Uncaught ReferenceError: axios is not defined`

**解决方案**：
1. 检查 HTML 文件的 `<head>` 标签中是否引入了 Axios CDN
2. 确保 Axios CDN 在其他 JS 文件之前引入
3. 检查网络连接，确保 CDN 资源能够正常加载

**正确的引入顺序**：

```html
<!-- 1. 先引入 Axios -->
<script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>

<!-- 2. 再引入配置和工具类 -->
<script src="../js/config.js"></script>
<script src="../js/utils/storage.js"></script>
<script src="../js/utils/http.js"></script>
```

---

### 问题 5：Maven 依赖下载失败

**现象**：IDEA 右下角显示 "Maven import failed"

**解决方案**：
1. 检查网络连接
2. 配置阿里云 Maven 镜像（在 `pom.xml` 同级目录创建 `settings.xml`）
3. 在 IDEA 中点击右侧 Maven 面板 → 刷新图标（Reload All Maven Projects）
4. 如果仍然失败，删除本地 Maven 仓库中的对应文件夹，重新下载

---

## 📚 今日知识点总结

### 后端核心技术

| 技术点 | 作用 | 关键类/注解 |
|--------|------|------------|
| **Spring Boot** | 快速搭建 Web 应用 | `@RestController`, `@RequestMapping` |
| **MyBatis-Plus** | 简化数据库操作 | `BaseMapper`, `LambdaQueryWrapper` |
| **Hutool JWT** | 生成和验证 Token | `JWTUtil.createToken()`, `JWTUtil.verify()` |
| **拦截器** | 统一验证用户登录状态 | `HandlerInterceptor`, `WebMvcConfigurer` |
| **DTO 模式** | 控制前后端数据传输 | `LoginDTO` |
| **统一响应** | 规范接口返回格式 | `Result<T>` |
| **跨域配置** | 允许前端跨域访问 | `addCorsMappings()` |

### 前端核心技术

| 技术点 | 作用 | 关键库/工具 |
|--------|------|------------|
| **Tailwind CSS** | 快速构建 UI 样式 | CDN 引入 |
| **Alpine.js** | 轻量级响应式框架 | `x-data`, `x-init`, `x-model` |
| **Axios** | HTTP 请求库 | 请求/响应拦截器 |
| **SweetAlert2** | 美化弹窗提示 | `Swal.fire()` |
| **NProgress** | 页面加载进度条 | `NProgress.start()`, `NProgress.done()` |
| **RemixIcon** | 图标库 | `<i class="ri-xxx">` |

### 关键设计模式

**后端**：
- **三层架构**：Controller（控制层）→ Service（业务层）→ Mapper（数据层）
- **DTO 模式**：前端传来的数据用 DTO 接收，避免直接使用实体类
- **统一响应**：所有接口返回 `Result<T>` 格式，前端统一处理
- **拦截器模式**：统一验证 Token，避免在每个接口中重复编写

**前端**：
- **分层架构**：配置层 → 工具层 → API 层 → 业务层 → 页面层
- **多页面应用**：每个功能模块独立成页，通过 `<a>` 标签跳转
- **请求拦截**：Axios 拦截器自动添加 Token、处理错误
- **模块化开发**：每个页面对应一个业务逻辑文件，避免代码混杂
